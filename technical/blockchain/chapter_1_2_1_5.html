<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>å¼€å‘æ™ºèƒ½åˆçº¦ - ä¿¡æ¯æŠ€æœ¯ | AwesomeProgram</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="æ‰€æ€å³æ‰€è§ï¼Œæ‰€è§å³æ‰€å¾—ï¼Œæ‰€å¾—çš†æ‰€æƒ³ï¼ŒæŠ€æœ¯ä»æœªåœæ­‡ï¼Œä¹Ÿæœªæ›¾ç¼ºä¹">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../PrefixChapter.html">å‰è¨€</a></li><li class="chapter-item expanded "><a href="../rust/chapter_1.html"><strong aria-hidden="true">1.</strong> Rust</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/chapter_1_1.html"><strong aria-hidden="true">1.1.</strong> Rust è¯­æ³•ç»“æ„</a></li><li class="chapter-item expanded "><a href="../rust/chapter_1_4.html"><strong aria-hidden="true">1.2.</strong> Rust æ ‡å‡†åº“</a></li><li class="chapter-item expanded "><a href="../rust/chapter_1_5.html"><strong aria-hidden="true">1.3.</strong> Rust å·¥å…·é“¾</a></li><li class="chapter-item expanded "><a href="../rust/chapter_1_6.html"><strong aria-hidden="true">1.4.</strong> Rust ç±»å‹æ“ä½œ</a></li><li class="chapter-item expanded "><a href="../rust/chapter_1_7.html"><strong aria-hidden="true">1.5.</strong> Rust ç¼–ç èŒƒå¼</a></li></ol></li><li class="chapter-item expanded "><a href="../go/chapter_1.html"><strong aria-hidden="true">2.</strong> Go</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../go/chapter_1_1.html"><strong aria-hidden="true">2.1.</strong> Go è¯­æ³•ç»“æ„</a></li><li class="chapter-item expanded "><a href="../go/chapter_1_2.html"><strong aria-hidden="true">2.2.</strong> Go æ ‡å‡†åº“</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_3.html"><strong aria-hidden="true">3.</strong> å„è¯­è¨€å¯¹æ¯”</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1.html"><strong aria-hidden="true">4.</strong> åŒºå—é“¾</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../blockchain/chapter_1_1.html"><strong aria-hidden="true">4.1.</strong> åŒºå—é“¾ç®€å²</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2.html"><strong aria-hidden="true">4.2.</strong> åŒºå—é“¾æ¡†æ¶</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1.html"><strong aria-hidden="true">4.2.1.</strong> substrate</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_1.html"><strong aria-hidden="true">4.2.1.1.</strong> åŸºæœ¬åŸç†</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_2.html"><strong aria-hidden="true">4.2.1.2.</strong> æ„å»ºä¸ç¼–ç </a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_3.html"><strong aria-hidden="true">4.2.1.3.</strong> å¯åŠ¨åŒºå—é“¾ç½‘ç»œ</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_4.html"><strong aria-hidden="true">4.2.1.4.</strong> è‡ªå®šä¹‰pallet</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_5.html" class="active"><strong aria-hidden="true">4.2.1.5.</strong> å¼€å‘æ™ºèƒ½åˆçº¦</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_6.html"><strong aria-hidden="true">4.2.1.6.</strong> æ¡¥æ¥å…¶å®ƒé“¾</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_7.html"><strong aria-hidden="true">4.2.1.7.</strong> å·¥å…·é›†æˆ</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_1_8.html"><strong aria-hidden="true">4.2.1.8.</strong> æµ‹è¯•</a></li></ol></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_2.html"><strong aria-hidden="true">4.2.2.</strong> fabric</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_2_1.html"><strong aria-hidden="true">4.2.2.1.</strong> åŸºæœ¬åŸç†</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_2_2.html"><strong aria-hidden="true">4.2.2.2.</strong> æ„å»ºä¸å¼€å‘</a></li></ol></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_3.html"><strong aria-hidden="true">4.2.3.</strong> EOSIO</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_3_1.html"><strong aria-hidden="true">4.2.3.1.</strong> åŸºæœ¬åŸç†</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_2_3_2.html"><strong aria-hidden="true">4.2.3.2.</strong> æ„å»ºä¸å¼€å‘</a></li></ol></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_3.html"><strong aria-hidden="true">4.2.4.</strong> æ™ºèƒ½åˆçº¦ä¸DApp</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../blockchain/chapter_1_3_1.html"><strong aria-hidden="true">4.2.4.1.</strong> Move</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_3_2.html"><strong aria-hidden="true">4.2.4.2.</strong> Solidity</a></li><li class="chapter-item expanded "><a href="../blockchain/chapter_1_3_3.html"><strong aria-hidden="true">4.2.4.3.</strong> Hardhat</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../cloud/chapter_1.html"><strong aria-hidden="true">5.</strong> äº‘è®¡ç®—</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cloud/chapter_1_1.html"><strong aria-hidden="true">5.1.</strong> äº‘è®¡ç®—ç®€å²</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_2.html"><strong aria-hidden="true">5.2.</strong> èµ„æºç¼–æ’æ¡†æ¶</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cloud/chapter_1_2_1.html"><strong aria-hidden="true">5.2.1.</strong> kubernetes</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_2_2.html"><strong aria-hidden="true">5.2.2.</strong> openstack</a></li></ol></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_3.html"><strong aria-hidden="true">5.3.</strong> è™šæ‹ŸåŒ–</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cloud/chapter_1_3_1.html"><strong aria-hidden="true">5.3.1.</strong> è®¡ç®—</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_3_2.html"><strong aria-hidden="true">5.3.2.</strong> ç½‘ç»œ</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_3_3.html"><strong aria-hidden="true">5.3.3.</strong> å­˜å‚¨</a></li></ol></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_4.html"><strong aria-hidden="true">5.4.</strong> å®¹å™¨</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cloud/chapter_1_4_1.html"><strong aria-hidden="true">5.4.1.</strong> docker</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_4_2.html"><strong aria-hidden="true">5.4.2.</strong> containerd</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_4_3.html"><strong aria-hidden="true">5.4.3.</strong> podman</a></li></ol></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_5.html"><strong aria-hidden="true">5.5.</strong> é«˜çº§è¯­è¨€è™šæ‹Ÿæœº</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cloud/chapter_1_5_1.html"><strong aria-hidden="true">5.5.1.</strong> wasm</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_5_2.html"><strong aria-hidden="true">5.5.2.</strong> jvm</a></li><li class="chapter-item expanded "><a href="../cloud/chapter_1_5_3.html"><strong aria-hidden="true">5.5.3.</strong> evm</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../privacy/chapter_1.html"><strong aria-hidden="true">6.</strong> éšç§è®¡ç®—</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../privacy/chapter_1_1.html"><strong aria-hidden="true">6.1.</strong> å¯†ç å­¦ç›¸å…³</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../privacy/chapter_1_1_1.html"><strong aria-hidden="true">6.1.1.</strong> é›¶çŸ¥è¯†è¯æ˜</a></li><li class="chapter-item expanded "><a href="../privacy/chapter_1_1_2.html"><strong aria-hidden="true">6.1.2.</strong> MPC</a></li><li class="chapter-item expanded "><a href="../privacy/chapter_1_1_3.html"><strong aria-hidden="true">6.1.3.</strong> å·®åˆ†éšç§</a></li><li class="chapter-item expanded "><a href="../privacy/chapter_1_1_4.html"><strong aria-hidden="true">6.1.4.</strong> ç§˜å¯†å…±äº«</a></li><li class="chapter-item expanded "><a href="../privacy/chapter_1_1_5.html"><strong aria-hidden="true">6.1.5.</strong> åŒæ€åŠ å¯†</a></li></ol></li><li class="chapter-item expanded "><a href="../privacy/chapter_1_2.html"><strong aria-hidden="true">6.2.</strong> å¯ä¿¡æ‰§è¡Œç¯å¢ƒ</a></li><li class="chapter-item expanded "><a href="../privacy/chapter_1_3.html"><strong aria-hidden="true">6.3.</strong> è”é‚¦å­¦ä¹ </a></li></ol></li><li class="chapter-item expanded "><a href="../quantum/chapter_1.html"><strong aria-hidden="true">7.</strong> é‡å­è®¡ç®—</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quantum/chapter_1_1.html"><strong aria-hidden="true">7.1.</strong> ç»å…¸è®¡ç®—ä¸é‡å­è®¡ç®—</a></li><li class="chapter-item expanded "><a href="../quantum/chapter_1_2.html"><strong aria-hidden="true">7.2.</strong> é‡å­è®¡ç®—ä¸­çš„æ¦‚å¿µ</a></li><li class="chapter-item expanded "><a href="../quantum/chapter_1_3.html"><strong aria-hidden="true">7.3.</strong> é‡å­è®¡ç®—ä¸­çš„ç®—æ³•</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter_8.html"><strong aria-hidden="true">8.</strong> è½¯è€ƒè®°å½•</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ä¿¡æ¯æŠ€æœ¯ | AwesomeProgram</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="å¼€å‘æ™ºèƒ½åˆçº¦"><a class="header" href="#å¼€å‘æ™ºèƒ½åˆçº¦">å¼€å‘æ™ºèƒ½åˆçº¦</a></h1>
<p>æœ¬æ•™ç¨‹æŒ‡å¯¼ä½ å¦‚ä½•ä½¿ç”¨ <a href="https://ink.substrate.io/">ink! ç¼–ç¨‹è¯­è¨€</a> ç”¨äºæ„å»ºåœ¨åŸºäº Substrate çš„åŒºå—é“¾ä¸Šè¿è¡Œçš„æ™ºèƒ½åˆçº¦ã€‚æœ¬èŠ‚ä¸­çš„æ•™ç¨‹ä½¿ç”¨é¢„é…ç½®çš„ <code>contracts-node</code> å’Œæ‰˜ç®¡ <a href="https://contracts-ui.substrate.io/">Contracts UI</a>ã€‚å¦‚æœè¦ä½¿ç”¨æ ‡å‡† node templateï¼Œéœ€è¦å°† Contracts pallet å’Œä¸€äº›å…¶ä»–ç»„ä»¶æ·»åŠ åˆ°å¼€å‘ç¯å¢ƒä¸­ã€‚åœ¨<strong>é…ç½®åˆçº¦pallet</strong>ä¸­è¯¦ç»†ä»‹ç»äº†ä¸ºæ„å»ºæ™ºèƒ½åˆçº¦å‡†å¤‡ node template çš„è¿‡ç¨‹ã€‚</p>
<h2 id="å‡†å¤‡ç¬¬ä¸€ä»½åˆçº¦"><a class="header" href="#å‡†å¤‡ç¬¬ä¸€ä»½åˆçº¦">å‡†å¤‡ç¬¬ä¸€ä»½åˆçº¦</a></h2>
<h3 id="æ›´æ–°ä½ çš„rustç¯å¢ƒ"><a class="header" href="#æ›´æ–°ä½ çš„rustç¯å¢ƒ">æ›´æ–°ä½ çš„Rustç¯å¢ƒ</a></h3>
<p>å¯¹äºæœ¬èŠ‚æ•™ç¨‹ï¼Œä½ éœ€è¦æ·»åŠ ä¸€äº›Rustæºä»£ç åˆ°ä½ çš„Substrateå¼€å‘ç¯å¢ƒä¹‹ä¸­ï¼Œé€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ›´æ–°ä½ çš„Rustç¯å¢ƒï¼š</p>
<pre><code class="language-bash editable noplayground">rustup component add rust-src --toolchain nightly
</code></pre>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤éªŒè¯ä½ å·²ç»å®‰è£…äº†WebAssemblyç›®æ ‡ï¼š</p>
<pre><code class="language-bash editable noplayground">rustup target add wasm32-unknown-unknown --toolchain nightly
</code></pre>
<p>å¦‚æœç›®æ ‡å·²å®‰è£…ä¸”æ˜¯æœ€æ–°çš„ï¼Œåˆ™è¯¥å‘½ä»¤å°†æ˜¾ç¤ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š</p>
<pre><code class="language-bash editable noplayground">info: component 'rust-std' for target 'wasm32-unknown-unknown' is up to date
</code></pre>
<h3 id="å®‰è£…substrateåˆçº¦node"><a class="header" href="#å®‰è£…substrateåˆçº¦node">å®‰è£…Substrateåˆçº¦node</a></h3>
<p>ä¸ºäº†ç®€åŒ–æœ¬èŠ‚æ•™ç¨‹ï¼Œä½ å¯ä»¥ä¸º Linux å’Œ macOS <a href="https://github.com/paritytech/substrate-contracts-node/releases">ä¸‹è½½</a>é¢„ç¼–è¯‘çš„ Substrate èŠ‚ç‚¹ï¼Œé¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹ä¸ºæ™ºèƒ½åˆçº¦åŒ…æ‹¬äº†FRAME palletã€‚æˆ–è€…ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ä½ çš„æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œ <code>cargo install contracts-node</code> æ‰‹åŠ¨æ„å»ºé¢„é…ç½®çš„ <code>contracts-node</code>ã€‚</p>
<p>åœ¨ macOS æˆ– Linux ä¸Šå®‰è£…å¯¹åº” <a href="https://github.com/paritytech/substrate-contracts-node/releases">Releases</a> ç‰ˆæœ¬çš„åˆçº¦èŠ‚ç‚¹ï¼Œä¸ºæœ¬åœ°è®¡ç®—æœºä¸‹è½½åˆé€‚çš„å‹ç¼©æ–‡ä»¶ã€‚</p>
<p>å¦‚æœæ— æ³•ä¸‹è½½é¢„ç¼–è¯‘èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºä»¥ä¸‹çš„å‘½ä»¤åœ¨æœ¬åœ°ç¼–è¯‘å®ƒï¼š</p>
<pre><code class="language-bash editable noplayground">cargo install contracts-node --git https://github.com/paritytech/substrate-contracts-node.git --tag &lt;latest-tag&gt; --force --locked
</code></pre>
<p>ä½ å¯ä»¥åœ¨ <a href="https://github.com/paritytech/substrate-contracts-node/tags">Tags</a> é¡µé¢ä¸Šå‘ç°æœ€æ–°çš„ tagã€‚ </p>
<h3 id="å®‰è£…å…¶å®ƒè½¯ä»¶åŒ…"><a class="header" href="#å®‰è£…å…¶å®ƒè½¯ä»¶åŒ…">å®‰è£…å…¶å®ƒè½¯ä»¶åŒ…</a></h3>
<p>ç¼–è¯‘ <code>contracts-node</code> åŒ…åï¼Œä½ éœ€è¦å®‰è£…å¦å¤–ä¸¤ä¸ªè½¯ä»¶åŒ…ï¼š</p>
<ul>
<li>ç”¨äºä½ çš„æ“ä½œç³»ç»Ÿçš„ WebAssembly <strong>binaryen</strong> åŒ…ï¼Œä¸ºåˆçº¦ä¼˜åŒ– WebAssembly å­—èŠ‚ç ã€‚</li>
<li>ç”¨äºé…ç½®æ™ºèƒ½åˆçº¦é¡¹ç›®çš„ <code>cargo-contract</code> å‘½ä»¤è¡Œæ¥å£ã€‚</li>
</ul>
<h4 id="å®‰è£…webassemblyä¼˜åŒ–å™¨"><a class="header" href="#å®‰è£…webassemblyä¼˜åŒ–å™¨">å®‰è£…WebAssemblyä¼˜åŒ–å™¨</a></h4>
<p>åœ¨ Ubuntu æˆ– Debian ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-bash editable noplayground">sudo apt install binaryen
</code></pre>
<p>åœ¨ macOS ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-bash editable noplayground">brew install binaryen
</code></pre>
<p>å¯¹äºå…¶å®ƒçš„æ“ä½œç³»ç»Ÿï¼Œä½ å¯ä»¥ç›´æ¥ä» <a href="https://github.com/WebAssembly/binaryen/releases">WebAssembly releases</a> ä¸Šä¸‹è½½ <code>binaryen</code> releaseã€‚</p>
<h4 id="å®‰è£…cargo-contractåŒ…"><a class="header" href="#å®‰è£…cargo-contractåŒ…">å®‰è£…cargo-contractåŒ…</a></h4>
<p>åœ¨ä½ å®‰è£… WebAssembly <code>binaryen</code> åŒ…ä¹‹åï¼Œä½ å¯ä»¥å®‰è£… <code>cargo-contract</code> åŒ…ã€‚<code>cargo-contract</code> åŒ…æä¾›ä¸€ä¸ªå‘½ä»¤è¡Œæ¥å£ï¼Œç”¨äºä½¿ç”¨ <code>ink!</code> è¯­è¨€å¤„ç†æ™ºèƒ½åˆçº¦ã€‚</p>
<p>å®‰è£… <code>dylint-link</code>ï¼Œéœ€è¦å®ƒæ¥ lint ink! contractsï¼Œæ³¨æ„ä½ ä½¿ç”¨ API çš„æ–¹å¼å¯èƒ½å­˜åœ¨ä¼šå¯¼è‡´å®‰å…¨çš„é—®é¢˜ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo install dylint-link
</code></pre>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… <code>cargo-contract</code>ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo install cargo-contract --force
</code></pre>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯å®‰è£…å¹¶å°è¯•å‘½ä»¤çš„å¯ç”¨é€‰é¡¹ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo contract --help
</code></pre>
<h3 id="åˆ›å»ºä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®"><a class="header" href="#åˆ›å»ºä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®">åˆ›å»ºä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®</a></h3>
<p>ä½ ç°åœ¨å¯ä»¥å¼€å§‹å¼€å‘æ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®äº†ï¼Œä¸ºæ™ºèƒ½åˆçº¦é¡¹ç›®ç”Ÿæˆæ–‡ä»¶ã€‚é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªåå« <code>flipper</code> çš„æ–°é¡¹ç›®æ–‡ä»¶å¤¹ã€‚</p>
<pre><code class="language-bash editable noplayground">cargo contract new flipper
</code></pre>
<p>åˆ‡æ¢åˆ°æ–°é¡¹ç›®æ–‡ä»¶å¤¹ä¸­å¹¶åˆ—å‡ºæ–‡ä»¶å¤¹ä¸­æ‰€æœ‰çš„å†…å®¹ï¼š</p>
<pre><code class="language-bash editable noplayground">cd flipper/ &amp;&amp; ls -al
</code></pre>
<p>ä½ åº”è¯¥å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤¹ä¸­åŒ…å«ä¸‹é¢çš„æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash editable noplayground">-rwxr-xr-x   1 dev-doc  staff   285 Mar  4 14:49 .gitignore
-rwxr-xr-x   1 dev-doc  staff  1023 Mar  4 14:49 Cargo.toml
-rwxr-xr-x   1 dev-doc  staff  2262 Mar  4 14:49 lib.rs
</code></pre>
<p>åƒå…¶å®ƒ Rust é¡¹ç›®ä¸€æ ·ï¼Œ<code>Cargo.tmol</code> æ–‡ä»¶è¢«ç”¨ä½œæä¾›åŒ…çš„ä¾èµ–å…³ç³»å’Œé…ç½®ä¿¡æ¯ã€‚<code>lib.rs</code> æ–‡ä»¶è¢«ç”¨ä½œä¸ºæ™ºèƒ½åˆçº¦ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h4 id="æµè§ˆé»˜è®¤é¡¹ç›®æ–‡ä»¶"><a class="header" href="#æµè§ˆé»˜è®¤é¡¹ç›®æ–‡ä»¶">æµè§ˆé»˜è®¤é¡¹ç›®æ–‡ä»¶</a></h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®ç”Ÿæˆä¸€äº›æ¨¡æ¿æºç ã€‚ä¸€ä¸ªéå¸¸ç®€å•çš„åˆçº¦ï¼Œç¬¬ä¸€ä¸ªå‡½æ•° <code>flip()</code>ï¼Œä¼šå°†å¸ƒå°”å˜é‡ä» true æ›´æ”¹ä¸º falseï¼›è¿˜æœ‰ç¬¬äºŒä¸ªå‡½æ•° <code>get()</code>ï¼Œä¼šè·å–å½“å‰å¸ƒå°”å˜é‡çš„å€¼ã€‚<code>lib.rs</code> æ–‡ä»¶è¿˜ä¼šåŒ…å«ä¸¤ä¸ªä¸ºæµ‹è¯•åˆçº¦æ˜¯å¦èƒ½æŒ‰ç…§æœŸæœ›å·¥ä½œçš„å‡½æ•°ã€‚</p>
<p>éšç€æœ¬èŠ‚æ•™ç¨‹åˆ°æœ€åï¼Œä½ ä¼šæ‹¥æœ‰ä¸€ä¸ªæ›´åŠ é«˜çº§å®Œæ•´çš„æ™ºèƒ½åˆçº¦ï¼Œåƒ <a href="https://github.com/paritytech/ink/blob/master/examples/flipper/lib.rs">Flipper example</a> ä¸€æ ·ã€‚</p>
<p>æ‰“å¼€ <code>Cargo.toml</code> æ–‡ä»¶å¹¶ä¸ºæŸ¥çœ‹åˆçº¦çš„ä¾èµ–å…³ç³»ï¼Œå¦‚æœ‰å¿…è¦ï¼Œåœ¨ <code>[dependencies]</code> éƒ¨åˆ†ï¼Œä¿®æ”¹ <code>scale</code> å’Œ <code>scale-info</code> çš„é…ç½®ï¼š</p>
<pre><code class="language-toml editable noplayground">scale = { package = &quot;parity-scale-codec&quot;, version = &quot;3&quot;, default-features = false, features = [&quot;derive&quot;] }
scale-info = { version = &quot;2&quot;, default-features = false, features = [&quot;derive&quot;], optional = true }
</code></pre>
<p>ä¿å­˜å¯¹ <code>Cargo.tmol</code> çš„ä»»ä½•å˜æ›´ï¼Œå¹¶å…³é—­è¯¥æ–‡ä»¶ã€‚</p>
<p>æ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œå¹¶æŸ¥çœ‹ä¸ºåˆçº¦å®šä¹‰çš„å‡½æ•°ã€‚</p>
<h4 id="æµ‹è¯•é»˜è®¤çš„åˆçº¦"><a class="header" href="#æµ‹è¯•é»˜è®¤çš„åˆçº¦">æµ‹è¯•é»˜è®¤çš„åˆçº¦</a></h4>
<p>åœ¨ <code>lib.rs</code> åŸä»£ç æ–‡ä»¶çš„åº•éƒ¨ï¼Œæœ‰ä¸€äº›ç®€å•çš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥éªŒè¯åˆçº¦çš„åŠŸèƒ½æ€§ã€‚ä½ å¯ä»¥ä½¿ç”¨é“¾ä¸‹æµ‹è¯•ç¯å¢ƒæ¥æµ‹è¯•æ­¤ä»£ç æ˜¯å¦æŒ‰ç…§é¢„æœŸæ‰§è¡Œã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½¿ç”¨ <code>test</code> å­å‘½ä»¤å’Œ <code>nightly</code> å·¥å…·é“¾æ¥ä¸º <code>flipper</code> åˆçº¦æ‰§è¡Œé»˜è®¤çš„æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”æ˜¾ç¤ºç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨ç¤ºæˆåŠŸå®Œæˆæµ‹è¯•ç”¨ä¾‹ï¼š</p>
<pre><code class="language-bash editable noplayground">running 2 tests
test flipper::tests::it_works ... ok
test flipper::tests::default_works ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre>
<h4 id="æ„å»ºåˆçº¦"><a class="header" href="#æ„å»ºåˆçº¦">æ„å»ºåˆçº¦</a></h4>
<p>æµ‹è¯•å®Œé»˜è®¤çš„åˆçº¦ä¹‹åï¼Œä½ å°±å¯ä»¥å¼€å§‹ç¼–è¯‘è¿™ä¸ªé¡¹ç›®åˆ° WebAssembly äº†ã€‚
ä¸ºæ™ºèƒ½åˆçº¦æ„å»º WebAssemblyï¼Œé€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œç¼–è¯‘ <code>flipper</code> æ™ºèƒ½åˆçº¦ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo +nightly contract build
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šä¸º <code>flipper</code> é¡¹ç›®æ„å»ºä¸€ä¸ª WebAssembly äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸€ä¸ªå…ƒæ•°æ®æ–‡ä»¶å¯ä»¥åŒ…å«åˆçº¦åº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆABIï¼‰ï¼Œå’Œä¸€ä¸ªä½ ç”¨æ¥éƒ¨ç½²åˆçº¦çš„ <code>.contract</code> æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºï¼š</p>
<pre><code class="language-bash editable noplayground">Original wasm size: 47.9K, Optimized: 22.8K

The contract was built in DEBUG mode.

Your contract artifacts are ready. You can find them in:
/Users/dev-doc/flipper/target/ink

- flipper.contract (code + metadata)
- flipper.wasm (the contract's code)
- metadata.json (the contract's metadata)
The `.contract` file can be used for deploying your contract to your chain.
</code></pre>
<p>åœ¨ <code>target/ink</code> ç›®å½•ä¸­çš„ <code>metadata.json</code> æ–‡ä»¶æè¿°äº†ä½ å¯ä»¥ç”¨æ¥ä¸æ­¤åˆçº¦äº¤äº’çš„æ‰€æœ‰æ¥å£ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å‡ ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li><code>spec</code> éƒ¨åˆ†åŒ…å«æœ‰å…³å‡½æ•°çš„ä¿¡æ¯ï¼Œåƒå¯è¢«è°ƒç”¨çš„ <strong>constructors</strong> å’Œ <strong>messages</strong>ï¼Œå¯è¢«å‘å‡ºçš„ <strong>events</strong>ï¼Œä»¥åŠå¯ç°å®çš„ä»»ä½•æ–‡æ¡£ã€‚è¿™ä¸ªéƒ¨åˆ†ä¹ŸåŒ…æ‹¬äº†ä¸€ä¸ª <code>selector</code> å­—æ®µï¼Œå®ƒåŒ…å«ä¸€ä¸ªå‡½æ•°åç§°çš„4å­—å“ˆå¸Œï¼Œå’Œç”¨äºå°†åˆçº¦è°ƒç”¨åˆ°æ­£ç¡®çš„å‡½æ•°ã€‚</li>
<li><code>storage</code> éƒ¨åˆ†å®šä¹‰äº†ç”±åˆçº¦ç®¡ç†çš„æ‰€æœ‰å­˜å‚¨é¡¹ä»¥åŠå¦‚ä½•è®¿é—®å®ƒä»¬ã€‚</li>
<li><code>types</code> éƒ¨åˆ†æä¾› JSON å…¶ä½™éƒ¨åˆ†ä¸­ä½¿ç”¨çš„è‡ªå®šä¹‰æ•°æ®ç±»å‹ã€‚</li>
</ul>
<h3 id="å¯åŠ¨substrateæ™ºèƒ½åˆçº¦èŠ‚ç‚¹"><a class="header" href="#å¯åŠ¨substrateæ™ºèƒ½åˆçº¦èŠ‚ç‚¹">å¯åŠ¨Substrateæ™ºèƒ½åˆçº¦èŠ‚ç‚¹</a></h3>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤åœ¨æœ¬åœ°å¼€å‘æ¨¡å¼ä¸­å¯åŠ¨é¢„é…ç½®çš„ <code>contracts-node</code>ï¼š</p>
<pre><code class="language-bash editable noplayground">substrate-contracts-node --dev
</code></pre>
<p>ä½ åº”è¯¥åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š</p>
<pre><code class="language-bash editable noplayground">2022-03-07 14:46:25 Substrate Contracts Node
2022-03-07 14:46:25 âœŒï¸  version 0.8.0-382b446-x86_64-macos
2022-03-07 14:46:25 â¤ï¸  by Parity Technologies &lt;admin@parity.io&gt;, 2021-2022
2022-03-07 14:46:25 ğŸ“‹ Chain specification: Development
2022-03-07 14:46:25 ğŸ·  Node name: possible-plants-8517
2022-03-07 14:46:25 ğŸ‘¤ Role: AUTHORITY
2022-03-07 14:46:25 ğŸ’¾ Database: RocksDb at /var/folders/2_/g86ns85j5l7fdnl621ptzn500000gn/T/substrateEdrJW9/chains/dev/db/full
2022-03-07 14:46:25 â›“  Native runtime: substrate-contracts-node-100 (substrate-contracts-node-1.tx1.au1)
2022-03-07 14:46:25 ğŸ”¨ Initializing Genesis block/state (state: 0xe9f1â€¦4b89, header-hash: 0xa1b6â€¦0194)
2022-03-07 14:46:25 ğŸ‘´ Loading GRANDPA authority set from genesis on what appears to be first startup.
2022-03-07 14:46:26 ğŸ·  Local node identity is: 12D3KooWQ3P8BH7Z1C1ZoNSXhdGPCiPR7irRSeQCQMFg5k3W9uVd
2022-03-07 14:46:26 ğŸ“¦ Highest known block at #0
</code></pre>
<p>åœ¨å‡ ç§’é’Ÿåï¼Œä½ è¿˜ä¼šçœ‹åˆ°åŒºå—è¢«æœ€ç»ˆç¡®è®¤çš„çŠ¶æ€ã€‚ä¸ºäº†ä¸åŒºå—é“¾äº¤äº’ï¼Œä½ éœ€è¦è¿æ¥æœ¬èŠ‚ç‚¹ã€‚ä½ å¯ä»¥é€šè¿‡æ‰“å¼€ <a href="https://contracts-ui.substrate.io/">Contracts UI</a> æµè§ˆå™¨é¡µé¢è¿æ¥å½“å‰èŠ‚ç‚¹ã€‚ç„¶åç‚¹å‡» <strong>Yes allow this application access</strong>ï¼Œé€‰æ‹©æœ¬åœ°èŠ‚ç‚¹ã€‚</p>
<h3 id="éƒ¨ç½²åˆçº¦"><a class="header" href="#éƒ¨ç½²åˆçº¦">éƒ¨ç½²åˆçº¦</a></h3>
<p>åœ¨ Substrate ä¸­ï¼Œåˆçº¦éƒ¨ç½²è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>å°†åˆçº¦ä»£ç ä¸Šä¼ åˆ°åŒºå—é“¾ã€‚</li>
<li>åˆ›å»ºåˆçº¦çš„ä¸€ä¸ªå®ä¾‹ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ç§æ¨¡å¼ï¼Œä½ å¯ä»¥å°†æ™ºèƒ½åˆçº¦ï¼ˆå¦‚ ERC20æ ‡å‡†ï¼‰çš„ä»£ç å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šä¸€æ¬¡ï¼Œç„¶åå°†å…¶å®ä¾‹åŒ–ä»»æ„æ¬¡æ•°ã€‚ä½ ä¸éœ€è¦é‡å¤åŠ è½½ç›¸åŒçš„æºä»£ç ï¼Œå› æ­¤ä½ çš„æ™ºèƒ½åˆçº¦ä¸ä¼šæ¶ˆè€—åŒºå—é“¾ä¸Šä¸å¿…è¦çš„èµ„æºã€‚</p>
<h4 id="ä¸Šä¼ åˆçº¦ä»£ç "><a class="header" href="#ä¸Šä¼ åˆçº¦ä»£ç ">ä¸Šä¼ åˆçº¦ä»£ç </a></h4>
<p>åœ¨æœ¬èŠ‚æ•™ç¨‹ä¸­ï¼Œä½ å°†ä½¿ç”¨ Contracts UI å‰ç«¯åœ¨ Substrate é“¾ä¸Šéƒ¨ç½² <code>flipper</code> åˆçº¦ã€‚</p>
<p>åœ¨ web æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="https://contracts-ui.substrate.io/">Contracts UI</a>ï¼Œç¡®è®¤ä½ å·²ç»è¿æ¥åˆ°äº† <strong>Local Node</strong>ï¼Œç‚¹å‡» <strong>Add New Contract</strong>ï¼Œç‚¹å‡» <strong>Upload New Contract Code</strong>ï¼Œé€‰æ‹©ç”¨äºåˆ›å»ºåˆçº¦å®ä¾‹çš„ <strong>Account</strong>ï¼Œä½ å¯ä»¥é€‰æ‹©ä»»ä½•å·²å­˜åœ¨çš„è´¦æˆ·ï¼ŒåŒ…æ‹¬ä¸€ä¸ªé¢„å®šä¹‰çš„è´¦æˆ·ï¼Œå¦‚ aliceã€‚è¾“å…¥ä¸€ä¸ªæ™ºèƒ½åˆçº¦çš„çš„åç§°ï¼Œä¾‹å¦‚ï¼ŒFlipper Contractã€‚</p>
<p>æµè§ˆå¹¶é€‰æ‹©æˆ–æ‹–æ”¾ <code>flipper.contract</code> æ–‡ä»¶ï¼ŒåŒ…å«ç»‘å®šçš„ Wasm blob å’Œå…ƒæ•°æ®æ–‡ä»¶åˆ° upload sectionã€‚</p>
<p><img src="https://awesomeprogram.gitee.io/imgdata/tech_bc_subuplocont.jpg" alt="" /></p>
<p>ç„¶åç‚¹å‡» <strong>Next</strong> ç»§ç»­ã€‚</p>
<h4 id="åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºä¸€ä¸ªå®ä¾‹"><a class="header" href="#åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºä¸€ä¸ªå®ä¾‹">åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºä¸€ä¸ªå®ä¾‹</a></h4>
<p>æ™ºèƒ½åˆçº¦ä½œä¸º Substrate åŒºå—é“¾ä¸Šè´¦æˆ·ç³»ç»Ÿçš„æ‰©å±•è€Œå­˜åœ¨ã€‚å½“ä½ åˆ›å»ºæ­¤æ™ºèƒ½åˆçº¦çš„å®ä¾‹æ—¶ï¼ŒSubstrate å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>AccountId</code>ï¼Œä»¥å­˜å‚¨æ™ºèƒ½åˆçº¦ç®¡ç†çš„ä»»ä½•ä½™é¢ï¼Œå¹¶å…è®¸ä½ ä¸è¯¥åˆçº¦è¿›è¡Œäº¤äº’ã€‚</p>
<p>åœ¨ä½ ä¸Šä¼ æ™ºèƒ½åˆçº¦å¹¶ç‚¹å‡» <strong>Next</strong> ä¹‹åï¼ŒContracts UI ä¼šæ˜¾ç¤ºæœ‰å…³æ™ºèƒ½åˆçº¦å†…å®¹çš„ä¿¡æ¯ã€‚</p>
<p>æŸ¥çœ‹å¹¶æ¥å—æ™ºèƒ½åˆçº¦åˆå§‹ç‰ˆæœ¬çš„é»˜è®¤ <code>Deployment Constructor</code> é€‰é¡¹ï¼ŒæŸ¥çœ‹å¹¶æ¥å—é»˜è®¤çš„ <strong>Max Gas Allowed</strong> <code>200000</code>ã€‚</p>
<p><img src="https://awesomeprogram.gitee.io/imgdata/tech_bc_subcreainst.jpg" alt="" /></p>
<p>ç‚¹å‡» <strong>Next</strong>ï¼Œäº¤æ˜“ç°åœ¨å·²å¼€å§‹è¿›å…¥é˜Ÿåˆ—ï¼Œå¦‚æœéœ€è¦è¿›è¡Œæ›´æ”¹ï¼Œå¯ä»¥ç‚¹å‡» <strong>Go Back</strong> ä¿®æ”¹è¾“å…¥ã€‚</p>
<p><img src="https://awesomeprogram.gitee.io/imgdata/tech_bc_subcomupl.jpg" alt="" /></p>
<p>ç‚¹å‡» <strong>Upload and Instantiate</strong>ï¼Œæ ¹æ®ä½ ä½¿ç”¨çš„å¸æˆ·ï¼Œå¯èƒ½ä¼šæç¤ºä½ è¾“å…¥å¸æˆ·å¯†ç ã€‚å¦‚æœä½ ä½¿ç”¨äº†é¢„å®šä¹‰çš„å¸æˆ·ï¼Œåˆ™ä¸éœ€è¦æä¾›å¯†ç ã€‚</p>
<p><img src="https://awesomeprogram.gitee.io/imgdata/tech_bc_subfirstcon.jpg" alt="" /></p>
<h3 id="è°ƒç”¨æ™ºèƒ½åˆçº¦"><a class="header" href="#è°ƒç”¨æ™ºèƒ½åˆçº¦">è°ƒç”¨æ™ºèƒ½åˆçº¦</a></h3>
<p>ç°åœ¨ï¼Œä½ çš„åˆçº¦å·²ç»éƒ¨ç½²åœ¨åŒºå—é“¾ä¸Šäº†ï¼Œä½ å¯ä»¥ä¸ä¹‹äº¤äº’ã€‚é»˜è®¤çš„ <code>flipper</code> æ™ºèƒ½åˆçº¦æœ‰ä¸¤ä¸ªå‡½æ•° <code>flip()</code> å’Œ <code>get()</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨  Contracts UI æ¥å°è¯•ä½¿ç”¨å®ƒä»¬ã€‚</p>
<h4 id="getå‡½æ•°"><a class="header" href="#getå‡½æ•°">get()å‡½æ•°</a></h4>
<p>å½“ä½ å®ä¾‹åŒ–åˆçº¦æ—¶ï¼Œå°† <code>flipper</code> åˆçº¦ <code>value</code> çš„åˆå§‹å€¼è®¾ç½®ä¸º <code>false</code>ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>get()</code> å‡½æ•°å»éªŒè¯å½“å‰å€¼æ˜¯å¦ä¸º <code>false</code>ã€‚</p>
<p>ä¸ºäº†æµ‹è¯• <code>get()</code> å‡½æ•°ï¼Œä» <strong>Account</strong> åˆ—è¡¨ä¸­é€‰æ‹©ä»»æ„è´¦æˆ·ï¼Œæ­¤åˆçº¦å¯¹å…è®¸è°å‘é€è¿™ä¸ª <code>get()</code> è¯·æ±‚æ²¡æœ‰é™åˆ¶ï¼Œä» <strong>Message to Send</strong> åˆ—è¡¨ä¸­é€‰æ‹© <strong>get(): bool</strong>ï¼Œç‚¹å‡» <strong>Read</strong>ï¼ŒéªŒè¯è°ƒç”¨ç»“æœçš„è¿”å›å€¼æ˜¯å¦ä¸º <code>false</code>ã€‚</p>
<p><img src="https://awesomeprogram.gitee.io/imgdata/tech_bc_subcallresget.jpg" alt="" /></p>
<h4 id="flipå‡½æ•°"><a class="header" href="#flipå‡½æ•°">flip()å‡½æ•°</a></h4>
<p><code>flip()</code> å‡½æ•°æŠŠå€¼ä» <code>false</code> æ”¹ä¸º <code>true</code>ã€‚</p>
<p>ä¸ºäº†æµ‹è¯• <code>flip()</code> å‡½æ•°ï¼Œä» <strong>Account</strong> åˆ—è¡¨ä¸­é€‰æ‹©ä»»æ„é¢„å®šä¹‰è´¦æˆ·ï¼Œ<code>flip()</code> å‡½æ•°æ˜¯ä¸€ä¸ªæ”¹å˜é“¾çŠ¶æ€çš„äº¤æ˜“ï¼Œéœ€è¦ä¸€ä¸ªæœ‰èµ„é‡‘çš„å¸æˆ·æ¥æ‰§è¡Œè°ƒç”¨ã€‚å› æ­¤ï¼Œä½ åº”è¯¥é€‰æ‹©å…·æœ‰é¢„å®šä¹‰ä½™é¢çš„å¸æˆ·ï¼Œä¾‹å¦‚ <code>alice</code> å¸æˆ·ã€‚ä» <strong>Message to Send</strong> åˆ—è¡¨ä¸­é€‰æ‹© <strong>flip()</strong>ï¼Œç‚¹å‡» <strong>Call</strong>ï¼ŒéªŒè¯è°ƒç”¨ç»“æœä¸­çš„äº¤æ˜“æ˜¯å¦æˆåŠŸã€‚</p>
<p><img src="https://awesomeprogram.gitee.io/imgdata/tech_bc_subsucctran.jpg" alt="" /></p>
<p>ä» <strong>Message to Send</strong> åˆ—è¡¨ä¸­é€‰æ‹© <strong>get(): bool</strong>ï¼Œç‚¹å‡» <strong>Read</strong>ï¼ŒéªŒè¯è°ƒç”¨ç»“æœä¸­çš„æ–°å€¼æ˜¯ <code>true</code>ã€‚</p>
<p><img src="https://awesomeprogram.gitee.io/imgdata/tech_bc_subfliptrue.jpg" alt="" /></p>
<h2 id="å¼€å‘ä¸€ä»½æ™ºèƒ½åˆçº¦"><a class="header" href="#å¼€å‘ä¸€ä»½æ™ºèƒ½åˆçº¦">å¼€å‘ä¸€ä»½æ™ºèƒ½åˆçº¦</a></h2>
<p>åœ¨æœ¬èŠ‚æ•™ç¨‹ä¸­ï¼Œä½ å°†å¼€å‘ä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦ï¼Œå®ƒå°†åœ¨æ¯æ¬¡æ‰§è¡Œå‡½æ•°è°ƒç”¨æ—¶å¢åŠ è®¡æ•°å™¨å€¼ã€‚</p>
<h3 id="æ™ºèƒ½åˆçº¦ä¸ink"><a class="header" href="#æ™ºèƒ½åˆçº¦ä¸ink">æ™ºèƒ½åˆçº¦ä¸ink!</a></h3>
<p>åœ¨ä¸Šä¸€èŠ‚æ•™ç¨‹ï¼ˆå‡†å¤‡ç¬¬ä¸€ä»½æ™ºèƒ½åˆçº¦ï¼‰ä¹‹åï¼Œä½ å·²ç»ä½å‘½ä»¤è¡Œè®¿é—® ink! ç¼–ç¨‹è¯­è¨€å®‰è£…äº† <code>cargo-contract</code> åŒ…ã€‚ink! è¯­è¨€æ˜¯<a href="https://wiki.haskell.org/Embedded_domain_specific_language">åµŒå…¥å¼é¢†åŸŸç‰¹å®šè¯­è¨€</a>ã€‚æ­¤è¯­è¨€ä½¿ä½ èƒ½å¤Ÿä½¿ç”¨ Rust ç¼–ç¨‹è¯­è¨€ç¼–å†™åŸºäº WebAssembly çš„æ™ºèƒ½åˆçº¦ã€‚</p>
<p>è¯¥è¯­è¨€ä½¿ç”¨æ ‡å‡†çš„ Rust æ¨¡å¼å’Œä¸“ç”¨çš„ <code>#[ink(...)]</code> å±æ€§å®ã€‚è¿™äº›å±æ€§å®æè¿°äº†æ™ºèƒ½åˆçº¦çš„ä¸åŒéƒ¨åˆ†ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥è¢«è½¬æ¢ä¸ºä¸ Substrate å…¼å®¹çš„ WebAssembly å­—èŠ‚ç ã€‚</p>
<h3 id="åˆ›å»ºä¸€ä»½æ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®"><a class="header" href="#åˆ›å»ºä¸€ä»½æ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®">åˆ›å»ºä¸€ä»½æ–°çš„æ™ºèƒ½åˆçº¦é¡¹ç›®</a></h3>
<p>æœ¬èŠ‚æ•™ç¨‹ä¸­ï¼Œä½ å°†ä¼šä¸º <code>incrementer</code> æ™ºèƒ½åˆçº¦åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚åˆ›å»ºçš„æ–°é¡¹ç›®ä¼šæ·»åŠ ä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æœ‰ä¸€ä¸ªé»˜è®¤çš„å¯åŠ¨æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å«åšæ¨¡æ¿æ–‡ä»¶ã€‚ä½ å°†ä¼šä¸º <code>incrementer</code> é¡¹ç›®ä¿®æ”¹è¿™äº›å¯åŠ¨æ¨¡æ¿æ–‡ä»¶ï¼Œæ¥æ„å»ºæ™ºèƒ½åˆçº¦æ‰€éœ€çš„é€»è¾‘ã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º <code>incrementer</code> çš„æ–°é¡¹ç›®ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo contract new incrementer
</code></pre>
<p>è¿›å…¥ <strong>incrementer</strong> æ–‡ä»¶å¤¹åï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>lib.rs</code> æ¨¡æ¿æ–‡ä»¶åŒ…å« <code>flipper</code> æ™ºèƒ½åˆçº¦çš„æºä»£ç ï¼Œåªæ˜¯æŠŠ <code>flipper</code> åˆçº¦çš„å®ä¾‹é‡å‘½åä¸º <code>incrementer</code>ã€‚æŠŠé»˜è®¤æ¨¡æ¿çš„æºä»£ç æ›¿æ¢ä¸ºæ–°çš„ <a href="https://docs.substrate.io/assets/tutorials/smart-contracts/incrementer-template.rs/"><strong>incrementer</strong></a> æºç ã€‚ä¿å­˜ <code>lib.rs</code> æ–‡ä»¶çš„æ”¹å˜å¹¶å…³é—­ã€‚</p>
<p>æ‰“å¼€ <code>Cargo.toml</code> æ–‡ä»¶ï¼Œå¹¶ä¸ºåˆçº¦æ£€æŸ¥ç›¸å…³çš„ä¾èµ–åŒ…ã€‚åœ¨ <code>[dependencies]</code> éƒ¨åˆ†ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œä¿®æ”¹ <code>scale</code> å’Œ <code>scale-info</code> é…ç½®å†…å®¹ã€‚</p>
<pre><code class="language-toml editable noplayground">scale = { package = &quot;parity-scale-codec&quot;, version = &quot;3&quot;, default-features = false, features = [&quot;derive&quot;] }
scale-info = { version = &quot;2&quot;, default-features = false, features = [&quot;derive&quot;], optional = true }
</code></pre>
<p>ä¿å­˜ä»£ç å¹¶å…³é—­ <code>Cargo.toml</code> æ–‡ä»¶ã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒéªŒè¯ç¨‹åºæ˜¯å¦ç¼–è¯‘å¹¶é€šè¿‡äº†ç®€å•çš„æµ‹è¯•ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>ä½ å¯ä»¥å¿½ç•¥ä»»ä½•è­¦å‘Šï¼Œå› ä¸ºæ­¤æ¨¡æ¿åªæ˜¯æ¡†æ¶ä»£ç ï¼Œè¯¥å‘½ä»¤åº”æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨ç¤ºæˆåŠŸå®Œæˆæµ‹è¯•ï¼š</p>
<pre><code class="language-bash editable noplayground">running 1 test
test incrementer::tests::default_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒéªŒè¯ä½ å¯ä»¥ä¸ºåˆçº¦æ„å»º WebAssemblyã€‚</p>
<pre><code class="language-bash editable noplayground">cargo +nightly contract build
</code></pre>
<p>å¦‚æœç¨‹åºæˆåŠŸç¼–è¯‘ï¼Œä½ å°±å¯ä»¥å¼€å§‹ç¼–ç äº†ã€‚</p>
<h3 id="å­˜å‚¨ç®€å•çš„å€¼"><a class="header" href="#å­˜å‚¨ç®€å•çš„å€¼">å­˜å‚¨ç®€å•çš„å€¼</a></h3>
<p>ç°åœ¨å·²ç»æœ‰äº†ä¸€äº› <code>incrementer</code> æ™ºèƒ½åˆçº¦çš„åˆå§‹æºä»£ç ï¼Œä½ å¯ä»¥å†å¼•å…¥ä¸€äº›æ–°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œè¯¥åˆçº¦éœ€è¦å­˜å‚¨ç®€å•çš„å€¼ã€‚ä¸‹é¢çš„ä»£ç è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ <code>#[ink(storage)]</code> å±æ€§å®ä¸ºè¯¥åˆçº¦å­˜å‚¨ç®€å•çš„å€¼ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(storage)]
pub struct MyContract {
	// Store a bool
	my_bool: bool,
	// Store a number
	my_number: u32,
}
</code></pre>
<h4 id="æ”¯æŒçš„ç±»å‹"><a class="header" href="#æ”¯æŒçš„ç±»å‹">æ”¯æŒçš„ç±»å‹</a></h4>
<p>Substrate æ™ºèƒ½åˆçº¦æ”¯æŒæœ€å¸¸è§çš„ Rust æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬å¸ƒå°”ç±»å‹ï¼Œæœªç­¾åå’Œå·²ç­¾åçš„æ•´æ•°å‹ï¼Œå­—ç¬¦ä¸²ï¼Œå…ƒç»„ï¼Œä»¥åŠæ•°ç»„ã€‚è¿™äº›æ•°æ®ç±»å‹ä½¿ç”¨ <a href="https://github.com/paritytech/parity-scale-codec"><strong>Parity scale codec</strong></a> è¿›è¡Œç¼–ç å’Œè§£ç ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ç½‘ç»œä¸Šé«˜æ•ˆçš„ä¼ è¾“ã€‚</p>
<p>é™¤äº†å¸¸è§çš„ Rust ç±»å‹ä½¿ç”¨ scale codec è¿›è¡Œç¼–ç è§£ç å¤–ï¼Œink! è¯­è¨€æ”¯æŒ Substrate ç‰¹æ€§ç±»å‹ï¼Œåƒ <code>AccountId</code>ï¼Œ<code>Balance</code>ï¼Œå’Œ <code>Hash</code>ï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯åŸå§‹ç±»å‹ã€‚ä¸‹é¢çš„ä»£ç è¯´æ˜äº†å¦‚ä½•ä¸ºè¯¥åˆçº¦å­˜å‚¨ä¸€ä¸ª <code>AccountId</code> å’Œ <code>Balance</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">// We are importing the default ink! types
use ink_lang as ink;

#[ink::contract]
mod MyContract {

	// Our struct will use those default ink! types
	#[ink(storage)]
	pub struct MyContract {
		// Store some AccountId
		my_account: AccountId,
		// Store some Balance
		my_balance: Balance,
	}
	/* --snip-- */
}
</code></pre>
<h4 id="æ„é€ å‡½æ•°"><a class="header" href="#æ„é€ å‡½æ•°">æ„é€ å‡½æ•°</a></h4>
<p>æ¯ä¸€ä¸ª ink! æ™ºèƒ½åˆçº¦å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªåœ¨åˆ›å»ºåˆçº¦æ—¶è¿è¡Œçš„æ„é€ å‡½æ•°ã€‚ç„¶è€Œï¼Œå¦‚æœä½ éœ€è¦ï¼Œä¸€ä¸ªæ™ºèƒ½åˆçº¦ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå¤šä¸ªæ„é€ å‡½æ•°ã€‚ä¸‹é¢çš„ä»£ç è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨å¤šä¸ªæ„é€ å‡½æ•°ï¼š</p>
<pre><code class="language-rust editable noplayground">use ink_lang as ink;

#[ink::contract]
mod mycontract {

	#[ink(storage)]
	pub struct MyContract {
		number: u32,
	}

	impl MyContract {
		/// Constructor that initializes the `u32` value to the given `init_value`.
		#[ink(constructor)]
		pub fn new(init_value: u32) -&gt; Self {
			Self {
				number: init_value,
			}
		}

		/// Constructor that initializes the `u32` value to the `u32` default.
		///
		/// Constructors can delegate to other constructors.
		#[ink(constructor)]
		pub fn default() -&gt; Self {
			Self {
				number: Default::default(),
			}
		}
	/* --snip-- */
	}
}
</code></pre>
<h3 id="æ›´æ–°ä½ çš„æ™ºèƒ½åˆçº¦"><a class="header" href="#æ›´æ–°ä½ çš„æ™ºèƒ½åˆçº¦">æ›´æ–°ä½ çš„æ™ºèƒ½åˆçº¦</a></h3>
<p>ç°åœ¨ä½ å·²ç»äº†è§£åˆ°å¦‚ä½•å­˜å‚¨ç®€å•çš„å€¼ï¼Œå£°æ˜æ•°æ®ç±»å‹ï¼Œä»¥åŠä½¿ç”¨æ„é€ å‡½æ•°ï¼Œä½ å¯ä»¥æ›´æ–°ä½ çš„æ™ºèƒ½åˆçº¦æºä»£ç ä»¥å®ç°ä¸‹é¢çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>value</code> çš„å­˜å‚¨å€¼ï¼Œæ•°æ®ç±»å‹ä¸º <code>i32</code>ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Incrementer</code> æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å°†å®ƒçš„ <code>value</code> è®¾ç½®ä¸º <code>init_value</code>ã€‚</li>
<li>åˆ›å»ºç¬¬äºŒä¸ªåå« <code>default</code> çš„æ„é€ å‡½æ•°ï¼Œè¯¥å‡½æ•°æ²¡æœ‰è¾“å…¥å‚æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Incrementer</code>ï¼Œå°†å…¶ <code>value</code> è®¾ç½®ä¸º <code>0</code>ã€‚</li>
</ul>
<p>ä¸ºäº†æ›´æ–°æ™ºèƒ½åˆçº¦ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œé€šè¿‡å£°æ˜åä¸º <code>value</code> æ•°æ®ç±»å‹ä¸º <code>i32</code> çš„å­˜å‚¨é¡¹ï¼Œä»è€Œæ›¿æ¢ <code>Storage Declaration</code> æ³¨é‡Šã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(storage)]
pub struct Incrementer {
   value: i32,
}
</code></pre>
<p>ä¿®æ”¹ <code>Incrementer</code> æ„é€ å‡½æ•°ï¼Œå°†å…¶ <code>value</code> è®¾ç½®ä¸º <code>init_value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">impl Incrementer {
 #[ink(constructor)]
 pub fn new(init_value: i32) -&gt; Self {
       Self {
         value: init_value,
       }
 }
}
</code></pre>
<p>æ·»åŠ ç¬¬äºŒä¸ªåä¸º <code>default</code> çš„æ„é€ å‡½æ•°ï¼Œè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Incrementer</code>ï¼Œå°†å…¶ <code>value</code> è®¾ç½®ä¸º <code>0</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(constructor)]
pub fn default() -&gt; Self {
   Self {
       value: 0,
   }
}
</code></pre>
<p>ä¿å­˜ä»£ç å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ <code>test</code> å­å‘½ä»¤å’Œ <code>nightly</code> å·¥å…·é“¾æ¥æµ‹è¯•ä½ çš„å·¥ä½œã€‚</p>
<pre><code class="language-rust editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”è¯¥æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨æ˜æµ‹è¯•æˆåŠŸå®Œæˆï¼š</p>
<pre><code class="language-bash editable noplayground">running 1 test
test incrementer::tests::default_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<h3 id="æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥è·å–ä¸€ä¸ªå­˜å‚¨å€¼"><a class="header" href="#æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥è·å–ä¸€ä¸ªå­˜å‚¨å€¼">æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥è·å–ä¸€ä¸ªå­˜å‚¨å€¼</a></h3>
<p>ç°åœ¨ä½ å·²ç»åˆ›å»ºå¹¶åˆå§‹åŒ–äº†å­˜å‚¨å€¼ï¼Œå¯ä»¥ä½¿ç”¨å…¬å…±å’Œç§æœ‰å‡½æ•°ä¸å®ƒè¿›è¡Œäº¤äº’ã€‚åœ¨æœ¬èŠ‚æ•™ç¨‹ä¸­ï¼Œä½ å°†æ·»åŠ ä¸€ä¸ªå…¬å…±å‡½æ•°æ¥è·å–å­˜å‚¨å€¼ã€‚è¯·æ³¨æ„ï¼Œæ‰€æœ‰å…¬å…±å‡½æ•°éƒ½å¿…é¡»ä½¿ç”¨ <code>#[ink(message)]</code> å±æ€§å®ã€‚</p>
<p>åœ¨æ™ºèƒ½åˆçº¦ä¸­æ·»åŠ å…¬å…±å‡½æ•°ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œæ›´æ–° <code>get</code> å…¬å…±å‡½æ•°ï¼Œä»¥è¿”å›æ•°æ®ç±»å‹ä¸º <code>i32</code> çš„å­˜å‚¨é¡¹çš„ <code>value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn get(&amp;self) -&gt; i32 {
   self.value
}
</code></pre>
<p>å› ä¸ºè¿™ä¸ªå‡½æ•°åªä»åˆçº¦å­˜å‚¨ä¸­è¯»å–æ•°æ®ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨ <code>&amp;self</code> å‚æ•°æ¥è®¿é—®åˆçº¦å‡½æ•°å’Œå­˜å‚¨é¡¹ï¼Œæ­¤å‡½æ•°ä¸å…è®¸æ›´æ”¹å­˜å‚¨é¡¹ <code>value</code> çš„çŠ¶æ€ã€‚å¦‚æœå‡½æ•°ä¸­çš„æœ€åä¸€ä¸ªè¡¨è¾¾å¼æ²¡æœ‰åˆ†å·ï¼ˆ;ï¼‰ï¼ŒRust å°†åˆ™å°†å…¶è§†ä¸ºè¿”å›å€¼ã€‚</p>
<p>å°†ç§æœ‰ <code>default_works</code> å‡½æ•°ä¸­çš„ <code>Test Your Contract</code> æ³¨é‡Šæ›¿æ¢ä¸ºæµ‹è¯• <code>get</code> å‡½æ•°çš„ä»£ç ã€‚</p>
<pre><code class="language-rust editable noplayground">fn default_works() {
   let contract = Incrementer::default();
   assert_eq!(contract.get(), 0);
}
</code></pre>
<p>ä¿å­˜ä»£ç å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ <code>test</code> å­å‘½ä»¤å’Œ <code>nightly</code> å·¥å…·é“¾æ¥æµ‹è¯•ä½ çš„å·¥ä½œã€‚</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<h3 id="æ·»åŠ ä¸€ä¸ªå‡½æ•°ä»¥ä¿®æ”¹ä¸€ä¸ªå­˜å‚¨å€¼"><a class="header" href="#æ·»åŠ ä¸€ä¸ªå‡½æ•°ä»¥ä¿®æ”¹ä¸€ä¸ªå­˜å‚¨å€¼">æ·»åŠ ä¸€ä¸ªå‡½æ•°ä»¥ä¿®æ”¹ä¸€ä¸ªå­˜å‚¨å€¼</a></h3>
<p>æ­¤æ—¶ï¼Œæ™ºèƒ½åˆçº¦ä¸å…è®¸ç”¨æˆ·ä¿®æ”¹å­˜å‚¨é¡¹ï¼Œè¦ä½¿ç”¨æˆ·èƒ½å¤Ÿä¿®æ”¹å­˜å‚¨é¡¹ï¼Œå¿…é¡»å°† <code>value</code> æ˜¾å¼æ ‡è®°ä¸ºå¯å˜å˜é‡ã€‚</p>
<p>æ·»åŠ ä¸€ä¸ªå‡½æ•°ä»¥å¢åŠ å­˜å‚¨é¡¹çš„å€¼ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„ <code>inc</code> å…¬å…±å‡½æ•°ä»¥å¢åŠ  <code>value</code> å­˜å‚¨ï¼Œä½¿ç”¨æ•°æ®ç±»å‹æ˜¯ <code>i32</code> çš„ <code>by</code> å‚æ•°</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn inc(&amp;mut self, by: i32) {
   self.value += by;
}
</code></pre>
<p>å‘æºä»£ç ä¸­æ·»åŠ ä¸€ä¸ªæ–°æµ‹è¯•ï¼Œä»¥éªŒè¯æ­¤å‡½æ•°ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink::test]
   fn it_works() {
       let mut contract = Incrementer::new(42);
       assert_eq!(contract.get(), 42);
       contract.inc(5);
       assert_eq!(contract.get(), 47);
       contract.inc(-50);
       assert_eq!(contract.get(), -3);
}
</code></pre>
<p>ä¿å­˜ä»£ç å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ <code>test</code> å­å‘½ä»¤å’Œ <code>nightly</code> å·¥å…·é“¾æ¥æµ‹è¯•ä½ çš„å·¥ä½œã€‚</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”è¯¥æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨æ˜æµ‹è¯•æˆåŠŸå®Œæˆï¼š</p>
<pre><code class="language-bash editable noplayground">running 2 tests
test incrementer::tests::it_works ... ok
test incrementer::tests::default_works ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<h4 id="ä¸ºåˆçº¦æ„å»ºwebassembly"><a class="header" href="#ä¸ºåˆçº¦æ„å»ºwebassembly">ä¸ºåˆçº¦æ„å»ºWebAssembly</a></h4>
<p>åœ¨æµ‹è¯• <code>incrementer</code> åˆçº¦ä¹‹åï¼Œå°±å¯ä»¥å°†æ­¤é¡¹ç›®ç¼–è¯‘ä¸º WebAssembly äº†ã€‚å°†æ™ºèƒ½åˆçº¦ç¼–è¯‘åˆ° WebAssembly åï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://contracts-ui.substrate.io/">Contracts UI</a> åœ¨æœ¬åœ°åˆçº¦èŠ‚ç‚¹ä¸Šéƒ¨ç½²å’Œæµ‹è¯•æ™ºèƒ½åˆçº¦ã€‚</p>
<p>ä¸ºæ™ºèƒ½åˆçº¦æ„å»ºWebAssemblyï¼Œåœ¨ <code>incrementer</code> é¡¹ç›®æ–‡ä»¶å¤¹é‡Œï¼Œé€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ç¼–è¯‘ <code>incrementer</code> æ™ºèƒ½åˆçº¦ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo +nightly contract build
</code></pre>
<p>è¯¥å‘½ä»¤æ˜¾ç¤ºå¦‚ä¸‹ç±»ä¼¼çš„è¾“å‡ºï¼š</p>
<pre><code class="language-bash editable noplayground">Your contract artifacts are ready. You can find them in:
/Users/dev-docs/incrementer/target/ink

- incrementer.contract (code + metadata)
- incrementer.wasm (the contract's code)
- metadata.json (the contract's metadata)
</code></pre>
<h3 id="éƒ¨ç½²ä¸æµ‹è¯•æ™ºèƒ½åˆçº¦"><a class="header" href="#éƒ¨ç½²ä¸æµ‹è¯•æ™ºèƒ½åˆçº¦">éƒ¨ç½²ä¸æµ‹è¯•æ™ºèƒ½åˆçº¦</a></h3>
<p>å¦‚æœä½ å·²ç»åœ¨æœ¬åœ°å®‰è£…äº† <code>substrate-contracts-node</code> èŠ‚ç‚¹ï¼Œä½ å¯ä»¥ä¸ºæ™ºèƒ½åˆçº¦å¯åŠ¨ä¸€ä¸ªæœ¬åœ°åŒºå—é“¾èŠ‚ç‚¹ï¼Œç„¶åä½¿ç”¨ <a href="https://contracts-ui.substrate.io/">Contracts UI</a> å»éƒ¨ç½²å’Œæµ‹è¯•æ™ºèƒ½åˆçº¦ã€‚</p>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨æœ¬åœ°å¼€å‘æ¨¡å¼ä¸‹å¯åŠ¨åˆçº¦èŠ‚ç‚¹ï¼š</p>
<pre><code class="language-bash editable noplayground">substrate-contracts-node --dev
</code></pre>
<p>æ‰“å¼€ <a href="https://contracts-ui.substrate.io/">Contracts UI</a> å¹¶éªŒè¯å…¶æ˜¯å¦è¿æ¥åˆ°æœ¬åœ°èŠ‚ç‚¹ã€‚
ç‚¹å‡» <strong>Add New Contract</strong>ã€‚
ç‚¹å‡» <strong>Upload New Contract Code</strong>ã€‚
é€‰æ‹© <code>incrementer.contract</code> æ–‡ä»¶ï¼Œç„¶åç‚¹å‡» <strong>Next</strong>ã€‚
ç‚¹å‡» <strong>Upload and Instantiate</strong>ã€‚
ä½¿ç”¨ Contracts UI æ¢ç´¢æ™ºèƒ½åˆçº¦å¹¶ä¸ä¹‹äº¤äº’ã€‚</p>
<p>å®Œæ•´çš„åˆçº¦ä»£ç ï¼š</p>
<pre><code class="language-rust editable noplayground">
#![cfg_attr(not(feature = &quot;std&quot;), no_std)]

use ink_lang as ink;

#[ink::contract]
mod incrementer {

    #[ink(storage)]
    pub struct Incrementer {
        value: i32,
    }

    impl Incrementer {
        #[ink(constructor)]
        pub fn new(init_value: i32) -&gt; Self {
            Self {
                value: init_value,
            }
        }

        #[ink(constructor)]
        pub fn default() -&gt; Self {
            Self {
                value: Default::default(),
            }
        }

        #[ink(message)]
        pub fn get(&amp;self) -&gt; i32 {
            self.value
        }

        #[ink(message)]
        pub fn inc(&amp;mut self, by: i32) {
            self.value += by;
        }
    }

    #[cfg(test)]
    mod tests {
        use super::*;
        use ink_lang as ink;

        #[ink::test]
        fn default_works() {
            let contract = Incrementer::default();
            assert_eq!(contract.get(), 0);
        }

        #[ink::test]
        fn it_works() {
            let mut contract = Incrementer::new(42);
            assert_eq!(contract.get(), 42);
            contract.inc(5);
            assert_eq!(contract.get(), 47);
            contract.inc(-50);
            assert_eq!(contract.get(), -3);
        }
    }
}
</code></pre>
<h2 id="ä½¿ç”¨mapså­˜å‚¨å€¼"><a class="header" href="#ä½¿ç”¨mapså­˜å‚¨å€¼">ä½¿ç”¨mapså­˜å‚¨å€¼</a></h2>
<p>æœ¬èŠ‚æ•™ç¨‹è¯´æ˜äº†å¦‚ä½•å¯ä»¥æ‰©å±•æ™ºèƒ½åˆçº¦çš„åŠŸèƒ½ï¼Œä»¥ç®¡ç†æ¯ä¸ªç”¨æˆ·çš„ä¸€ä¸ªå·ç ã€‚è¦æ·»åŠ è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å°†ä¼šä½¿ç”¨ <a href="https://paritytech.github.io/ink/ink_storage/struct.Mapping.html"><code>Mapping</code></a> ç±»å‹ã€‚</p>
<p>ink! è¯­è¨€æä¾› <a href="https://paritytech.github.io/ink/ink_storage/struct.Mapping.html"><code>Mapping</code></a> ç±»å‹ï¼Œä½¿ä½ èƒ½å¤Ÿå°†æ•°æ®å­˜å‚¨ä¸ºé”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç è¯´æ˜äº†æ˜ å°„ä¸€ä¸ªç”¨æˆ·åˆ°ä¸€ä¸ªå·ç ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(storage)]
pub struct MyContract {
	// Store a mapping from AccountIds to a u32
	my_number_map: ink_storage::Mapping&lt;AccountId, u32&gt;,
}
</code></pre>
<p>ä½¿ç”¨ <code>Mapping</code> æ•°æ®ç±»å‹ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªé”®å­˜å‚¨å€¼çš„å”¯ä¸€å®ä¾‹ã€‚æœ¬èŠ‚æ•™ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ª <code>AccountId</code> ä»£è¡¨ä¸€ä¸ªé”®ï¼Œè¯¥é”®æ˜ å°„åˆ°ä¸€ä¸ªä¸”ä»…ä¸€ä¸ªå­˜å‚¨çš„æ•°å­— <code>my_value</code>ã€‚æ¯ä¸ªç”¨æˆ·åªèƒ½å­˜å‚¨ã€å¢åŠ å’Œæ£€ç´¢ä¸å…¶è‡ªå·±çš„ <code>AccountId</code> å…³è”çš„å€¼ã€‚</p>
<h3 id="åˆå§‹åŒ–ä¸€ä¸ªmapping"><a class="header" href="#åˆå§‹åŒ–ä¸€ä¸ªmapping">åˆå§‹åŒ–ä¸€ä¸ªmapping</a></h3>
<p>ç¬¬ä¸€æ­¥æ˜¯åˆå§‹åŒ– <code>AccountId</code> å’Œå­˜å‚¨å€¼ä¹‹é—´çš„æ˜ å°„ã€‚åœ¨ä½ çš„åˆçº¦ä¸­ä½¿ç”¨æ˜ å°„ä¹‹å‰ï¼Œä½ å¿…é¡»å§‹ç»ˆåˆå§‹åŒ–æ˜ å°„ï¼Œä»¥é¿å…æ˜ å°„é”™è¯¯å’Œä¸ä¸€è‡´ã€‚è¦åˆå§‹åŒ–æ˜ å°„ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>åœ¨å­˜å‚¨ç»“æ„ä¸Šæ·»åŠ  <a href="https://paritytech.github.io/ink/ink_storage/traits/trait.SpreadAllocate.html"><code>SpreadAllocate</code></a></li>
<li>æŒ‡å®šæ˜ å°„é”®å’Œæ˜ å°„åˆ°å®ƒçš„å€¼ã€‚</li>
<li>è°ƒç”¨ <a href="https://paritytech.github.io/ink/ink_lang/utils/fn.initialize_contract.html"><code>ink_lang::utils::initalize_contract</code></a> å‡½æ•°æ¥åˆå§‹åŒ–åˆçº¦çš„æ˜ å°„ã€‚</li>
</ul>
<p>ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜å¦‚ä½•åˆå§‹åŒ–ä¸€ä¸ªæ˜ å°„å¹¶æ£€ç´¢ä¸€ä¸ªå€¼ï¼š</p>
<pre><code class="language-rust editable noplayground">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]

use ink_lang as ink;

#[ink::contract]
mod mycontract {
    use ink_storage::traits::SpreadAllocate;

    #[ink(storage)]
    #[derive(SpreadAllocate)]
    pub struct MyContract {
        // Store a mapping from AccountIds to a u32
        map: ink_storage::Mapping&lt;AccountId, u32&gt;,
    }

    impl MyContract {
        #[ink(constructor)]
        pub fn new(count: u32) -&gt; Self {
            // This call is required to correctly initialize the
            // Mapping of the contract.
            ink_lang::utils::initialize_contract(|contract: &amp;mut Self| {
                let caller = Self::env().caller();
                contract.map.insert(&amp;caller, &amp;count);
            })
        }

        #[ink(constructor)]
        pub fn default() -&gt; Self {
            ink_lang::utils::initialize_contract(|_| {})
        }

        // Get the number associated with the caller's AccountId, if it exists
        #[ink(message)]
        pub fn get(&amp;self) -&gt; u32 {
            let caller = Self::env().caller();
            self.map.get(&amp;caller).unwrap_or_default()
        }
    }
}
</code></pre>
<h4 id="è¯†åˆ«åˆçº¦çš„è°ƒç”¨è€…"><a class="header" href="#è¯†åˆ«åˆçº¦çš„è°ƒç”¨è€…">è¯†åˆ«åˆçº¦çš„è°ƒç”¨è€…</a></h4>
<p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯èƒ½æ³¨æ„åˆ°äº† <code>self.env().caller()</code> å‡½æ•°è°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°åœ¨æ•´ä¸ªåˆçº¦é€»è¾‘ä¸­éƒ½æ˜¯å¯ç”¨çš„ï¼Œå¹¶ä¸”æ€»æ˜¯è¿”å› <strong>contract caller</strong>ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œ<strong>contract caller</strong> ä¸ <strong>origin caller</strong> æ˜¯ä¸åŒçš„ã€‚å¦‚æœç”¨æˆ·è®¿é—®ä¸€ä¸ªåˆçº¦ï¼Œç„¶åå†è°ƒç”¨åæ¥çš„åˆçº¦ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªåˆçº¦ä¸­çš„ <code>self.env().caller()</code> æ˜¯ç¬¬ä¸€ä¸ªåˆçº¦çš„åœ°å€ï¼Œè€Œä¸æ˜¯ original user çš„åœ°å€ã€‚</p>
<h4 id="ä½¿ç”¨åˆçº¦çš„è°ƒç”¨è€…"><a class="header" href="#ä½¿ç”¨åˆçº¦çš„è°ƒç”¨è€…">ä½¿ç”¨åˆçº¦çš„è°ƒç”¨è€…</a></h4>
<p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œåˆçº¦è°ƒç”¨è€…éƒ½æ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>self.env().caller()</code> æ¥åˆ›å»ºä¸€ä¸ªè®¿é—®æ§åˆ¶å±‚ï¼Œè¯¥å±‚åªå…è®¸ç”¨æˆ·è®¿é—®è‡ªå·±çš„å€¼ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>self.env().caller()</code> åœ¨åˆåŒéƒ¨ç½²æœŸé—´ä¿å­˜åˆçº¦æ‰€æœ‰è€…ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-rust editable noplayground">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]

use ink_lang as ink;

#[ink::contract]
mod mycontract {

	#[ink(storage)]
	pub struct MyContract {
		// Store a contract owner
		owner: AccountId,
	}

	impl MyContract {
		#[ink(constructor)]
		pub fn new() -&gt; Self {
			Self {
				owner: Self::env().caller();
			}
		}
		/* --snip-- */
	}
}
</code></pre>
<p>å› ä¸ºä½ å·²ç»ä½¿ç”¨ <code>owner</code> æ ‡è¯†ç¬¦ä¿å­˜äº†åˆçº¦è°ƒç”¨è€…ï¼Œæ‰€ä»¥ä½ å¯ä»¥å†åé¢ç¼–å†™å‡½æ•°æ¥æ£€æŸ¥å½“å‰åˆçº¦è°ƒç”¨è€…æ˜¯å¦æ˜¯åˆåŒçš„æ‰€æœ‰è€…ã€‚</p>
<h3 id="æ·»åŠ mappingåˆ°æ™ºèƒ½åˆçº¦ä¸­"><a class="header" href="#æ·»åŠ mappingåˆ°æ™ºèƒ½åˆçº¦ä¸­">æ·»åŠ mappingåˆ°æ™ºèƒ½åˆçº¦ä¸­</a></h3>
<p>ä¸º <code>incrementer</code> åˆçº¦æ·»åŠ  storage mapï¼Œåœ¨ <code>incrementer</code> é¡¹ç›®æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰“å¼€ <code>lib.rs</code>ï¼Œä¸ºä½ çš„åˆçº¦å¯¼å…¥ <code>SpreadAllocate</code> ç‰¹å¾å¹¶è¿½åŠ æ´¾ç”Ÿå®ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink::contract]
mod incrementer {
   use ink_storage::traits::SpreadAllocate;

   #[ink(storage)]
   #[derive(SpreadAllocate)]
</code></pre>
<p>å°†æ˜ å°„é”®ä» <code>AccountId</code> æ·»åŠ åˆ°å­˜å‚¨ä¸º <code>my_value</code> çš„ <code>i32</code> æ•°æ®ç±»å‹ã€‚</p>
<pre><code class="language-rust editable noplayground">pub struct Incrementer {
   value: i32,
   my_value: ink_storage::Mapping&lt;AccountId, i32&gt;,
}
</code></pre>
<p>ä½¿ç”¨ <code>initialize_contract</code> å‡½æ•°ä¸ºåˆçº¦ä¸­çš„ <code>new</code> å‡½æ•°è®¾ç½®ä¸€ä¸ªåˆå§‹ <code>value</code> å’Œ <code>my_value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(constructor)]
pub fn new(init_value: i32) -&gt; Self {
   ink_lang::utils::initialize_contract(|contract: &amp;mut Self| {
       contract.value = init_value;
       let caller = Self::env().caller();
       contract.my_value.insert(&amp;caller, &amp;0);
   })
}
</code></pre>
<p>ä½¿ç”¨ <code>initialize_contract</code> å‡½æ•°ä¸ºåˆçº¦ä¸­çš„ <code>default</code> å‡½æ•°è®¾ç½®ä¸€ä¸ªåˆå§‹ <code>value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(constructor)]
pub fn default() -&gt; Self {
   ink_lang::utils::initialize_contract(|contract: &amp;mut Self| {
       contract.value = Default::default();
   })
}
</code></pre>
<p>æ·»åŠ ä¸€ä¸ª <code>get_mine</code> å‡½æ•°ï¼Œä½¿ç”¨ Mapping API <code>get</code> å‡½æ•°è¯»å– <code>my_value</code>ï¼Œå¹¶ä¸ºåˆçº¦è°ƒç”¨è€…è¿”å› <code>my_value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn get_mine(&amp;self) -&gt; i32 {
   self.my_value.get(&amp;self.env().caller()).unwrap_or_default()
}
</code></pre>
<p>å‘åˆå§‹åŒ–å¸æˆ·æ·»åŠ ä¸€ä¸ªæ–°æµ‹è¯•ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink::test]
fn my_value_works() {
   let contract = Incrementer::new(11);
   assert_eq!(contract.get(), 11);
   assert_eq!(contract.get_mine(), 0);
}
</code></pre>
<p>ä¿å­˜ä»£ç å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ <code>test</code> å­å‘½ä»¤å’Œ <code>nightly</code> å·¥å…·é“¾æ¥æµ‹è¯•ä½ çš„å·¥ä½œã€‚</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”è¯¥æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨æ˜æµ‹è¯•æˆåŠŸå®Œæˆï¼š</p>
<pre><code class="language-bash editable noplayground">running 3 tests
test incrementer::tests::default_works ... ok
test incrementer::tests::it_works ... ok
test incrementer::tests::my_value_works ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<h3 id="æ’å…¥æ›´æ–°æˆ–åˆ é™¤å€¼"><a class="header" href="#æ’å…¥æ›´æ–°æˆ–åˆ é™¤å€¼">æ’å…¥ï¼Œæ›´æ–°æˆ–åˆ é™¤å€¼</a></h3>
<p><code>ink_storage</code> æ˜ å°„æä¾›å¯¹å­˜å‚¨é¡¹çš„ç›´æ¥è®¿é—®ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„é”®è°ƒç”¨ <code>Mapping::insert()</code> æ¥æ›¿æ¢å­˜å‚¨é¡¹ä¹‹å‰ä¿å­˜çš„å€¼ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ <code>Mapping::insert()</code> åœ¨å­˜å‚¨ä¸­ç¬¬ä¸€æ¬¡è¯»å–å€¼æ—¶ï¼Œç„¶åç”¨ <code>Mapping::insert()</code> æ›´æ–°è¿™ä¸ªå€¼ã€‚å¦‚æœä¸å­˜åœ¨ç»™å®šé”®çš„å€¼ï¼Œåˆ™ <code>Mapping::get()</code> è¿”å› <code>None</code>ã€‚å› ä¸º Mapping API æä¾›äº†å¯¹å­˜å‚¨çš„ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ <code>Mapping::remove()</code> æ–¹æ³•ä»å­˜å‚¨ä¸­åˆ é™¤ç»™å®šé”®çš„å€¼ã€‚</p>
<p>è¦æ·»åŠ æ’å…¥å’Œåˆ é™¤å‡½æ•°åˆ°åˆçº¦ä¸­ï¼Œåœ¨ <code>incrementer</code> é¡¹ç›®æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ª <code>inc_mine()</code> å‡½æ•°ï¼Œå®ƒå…è®¸åˆçº¦è°ƒç”¨è€…è·å– <code>my_value</code> å­˜å‚¨é¡¹ï¼Œå¹¶ä¸”åœ¨æ˜ å°„ä¸­æ’å…¥é€’å¢çš„ <code>value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn inc_mine(&amp;mut self, by: i32) {
   let caller = self.env().caller();
   let my_value = self.get_mine();
   self.my_value.insert(caller, &amp;(my_value + by));
}
</code></pre>
<p>æ·»åŠ ä¸€ä¸ª <code>remove_mine()</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°å…è®¸åˆçº¦è°ƒç”¨è€…ä»å­˜å‚¨ä¸­è·å–å¯åˆ é™¤çš„ <code>my_value</code> å­˜å‚¨é¡¹ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn remove_mine(&amp;mut self) {
   self.my_value.remove(&amp;self.env().caller())
}
</code></pre>
<p>æ·»åŠ ä¸€ä¸ªæ–°æµ‹è¯•ï¼Œä»¥éªŒè¯ <code>inc_mine()</code> å‡½æ•°æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink::test]
fn inc_mine_works() {
   let mut contract = Incrementer::new(11);
   assert_eq!(contract.get_mine(), 0);
   contract.inc_mine(5);
   assert_eq!(contract.get_mine(), 5);
   contract.inc_mine(5);
   assert_eq!(contract.get_mine(), 10);
}
</code></pre>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ <code>test</code> å­å‘½ä»¤å’Œ <code>nightly</code> å·¥å…·é“¾æ¥æµ‹è¯•ä½ çš„å·¥ä½œã€‚</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”è¯¥æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨æ˜æµ‹è¯•æˆåŠŸå®Œæˆï¼š</p>
<pre><code class="language-bash editable noplayground">running 5 tests
test incrementer::tests::default_works ... ok
test incrementer::tests::it_works ... ok
test incrementer::tests::remove_mine_works ... ok
test incrementer::tests::inc_mine_works ... ok
test incrementer::tests::my_value_works ... ok

test result: ok. 5 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<p>å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-rust editable noplayground">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]

use ink_lang as ink;

#[ink::contract]
mod incrementer {
    use ink_storage::traits::SpreadAllocate;

    #[ink(storage)]
    #[derive(SpreadAllocate)]
    pub struct Incrementer {
        value: i32,
        my_value: ink_storage::Mapping&lt;AccountId, i32&gt;,
    }

    impl Incrementer {
        #[ink(constructor)]
        pub fn new(init_value: i32) -&gt; Self {
            // This call is required in order to correctly initialize the
            // `Mapping`s of our contract.
            ink_lang::utils::initialize_contract(|contract: &amp;mut Self| {
                contract.value = init_value;
                let caller = Self::env().caller();
                contract.my_value.insert(&amp;caller, &amp;0);
            })
        }

        #[ink(constructor)]
        pub fn default() -&gt; Self {
            // Even though we're not explicitly initializing the `Mapping`,
            // we still need to call this
            ink_lang::utils::initialize_contract(|contract: &amp;mut Self| {
                contract.value = Default::default();
            })
        }

        #[ink(message)]
        pub fn get(&amp;self) -&gt; i32 {
            self.value
        }

        #[ink(message)]
        pub fn inc(&amp;mut self, by: i32) {
            self.value += by;
        }

        #[ink(message)]
        pub fn get_mine(&amp;self) -&gt; i32 {
            self.my_value.get(&amp;self.env().caller()).unwrap_or_default()
        }

        #[ink(message)]
        pub fn inc_mine(&amp;mut self, by: i32) {
            let caller = self.env().caller();
            let my_value = self.get_mine();
            self.my_value.insert(caller, &amp;(my_value + by));
        }

        #[ink(message)]
        pub fn remove_mine(&amp;self) {
            self.my_value.remove(&amp;self.env().caller())
        }
    }

    #[cfg(test)]
    mod tests {
        use super::*;

        use ink_lang as ink;

        #[ink::test]
        fn default_works() {
            let contract = Incrementer::default();
            assert_eq!(contract.get(), 0);
        }

        #[ink::test]
        fn it_works() {
            let mut contract = Incrementer::new(42);
            assert_eq!(contract.get(), 42);
            contract.inc(5);
            assert_eq!(contract.get(), 47);
            contract.inc(-50);
            assert_eq!(contract.get(), -3);
        }

        #[ink::test]
        fn my_value_works() {
            let mut contract = Incrementer::new(11);
            assert_eq!(contract.get(), 11);
            assert_eq!(contract.get_mine(), 0);
            contract.inc_mine(5);
            assert_eq!(contract.get_mine(), 5);
            contract.inc_mine(10);
            assert_eq!(contract.get_mine(), 15);
        }

        #[ink::test]
        fn inc_mine_works() {
            let mut contract = Incrementer::new(11);
            assert_eq!(contract.get_mine(), 0);
            contract.inc_mine(5);
            assert_eq!(contract.get_mine(), 5);
            contract.inc_mine(5);
            assert_eq!(contract.get_mine(), 10);
        }

        #[ink::test]
        fn remove_mine_works() {
            let mut contract = Incrementer::new(11);
            assert_eq!(contract.get_mine(), 0);
            contract.inc_mine(5);
            assert_eq!(contract.get_mine(), 5);
            contract.remove_mine();
            assert_eq!(contract.get_mine(), 0);
        }
    }
}
</code></pre>
<h2 id="æ„å»ºä¸€ä¸ªtokenåˆçº¦"><a class="header" href="#æ„å»ºä¸€ä¸ªtokenåˆçº¦">æ„å»ºä¸€ä¸ªtokenåˆçº¦</a></h2>
<p>æœ¬èŠ‚æ•™ç¨‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ ink! è¯­è¨€æ„å»º ERC-20 ä»£å¸åˆçº¦ï¼ŒERC-20 è§„èŒƒå®šä¹‰äº†å¯æ›¿æ¢ä»£å¸çš„é€šç”¨æ ‡å‡†ã€‚æ‹¥æœ‰å®šä¹‰ä»£å¸å±æ€§çš„æ ‡å‡†ï¼Œä½¿éµå¾ªè§„èŒƒçš„å¼€å‘äººå‘˜ï¼Œèƒ½å¤Ÿæ„å»ºä¸å…¶ä»–äº§å“å’ŒæœåŠ¡äº’æ“ä½œçš„åº”ç”¨ç¨‹åºã€‚ERC-20 ä»£å¸æ ‡å‡†ä¸æ˜¯å”¯ä¸€çš„ä»£å¸æ ‡å‡†ï¼Œä½†å®ƒæ˜¯æœ€å¸¸ç”¨çš„æ ‡å‡†ä¹‹ä¸€ã€‚</p>
<h3 id="erc-20æ ‡å‡†çš„åŸºç¡€çŸ¥è¯†"><a class="header" href="#erc-20æ ‡å‡†çš„åŸºç¡€çŸ¥è¯†">ERC-20æ ‡å‡†çš„åŸºç¡€çŸ¥è¯†</a></h3>
<p>ERC-20 ä»£å¸æ ‡å‡†å®šä¹‰äº†è¿è¡Œåœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„å¤§å¤šæ•°æ™ºèƒ½åˆçº¦çš„æ¥å£ã€‚è¿™äº›æ ‡å‡†æ¥å£å…è®¸ä¸ªäººåœ¨ç°æœ‰çš„æ™ºèƒ½åˆçº¦å¹³å°ä¸Šéƒ¨ç½²è‡ªå·±çš„åŠ å¯†è´§å¸ã€‚</p>
<p>å¦‚æœä½ æŸ¥çœ‹è¯¥æ ‡å‡†ï¼Œä½ ä¼šå‘ç°æœ‰å¦‚ä¸‹è¢«å®šä¹‰çš„æ ¸å¿ƒå‡½æ•°ï¼š</p>
<pre><code class="language-javascript editable noplayground">// ----------------------------------------------------------------------------
// ERC Token Standard #20 Interface
// https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md
// ----------------------------------------------------------------------------

contract ERC20Interface {
    // Storage Getters
    function totalSupply() public view returns (uint);
    function balanceOf(address tokenOwner) public view returns (uint balance);
    function allowance(address tokenOwner, address spender) public view returns (uint remaining);

    // Public Functions
    function transfer(address to, uint tokens) public returns (bool success);
    function approve(address spender, uint tokens) public returns (bool success);
    function transferFrom(address from, address to, uint tokens) public returns (bool success);

    // Contract Events
    event Transfer(address indexed from, address indexed to, uint tokens);
    event Approval(address indexed tokenOwner, address indexed spender, uint tokens);
}
</code></pre>
<p>ç”¨æˆ·ä½™é¢æ˜ å°„åˆ°å¸æˆ·åœ°å€ï¼Œæ¥å£å…è®¸ç”¨æˆ·è½¬ç§»ä»–ä»¬æ‹¥æœ‰çš„ä»£å¸æˆ–å…è®¸ç¬¬ä¸‰æ–¹ä»£è¡¨ä»–ä»¬è½¬ç§»ä»£å¸ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¿…é¡»å®ç°æ™ºèƒ½åˆçº¦é€»è¾‘ï¼Œä»¥ç¡®ä¿èµ„é‡‘ä¸ä¼šè¢«æ— æ„åˆ›å»ºæˆ–é”€æ¯ï¼Œå¹¶ä¿æŠ¤ç”¨æˆ·çš„èµ„é‡‘å…å—æ¶æ„å‚ä¸è€…çš„æ”»å‡»ã€‚è¯·æ³¨æ„ï¼Œæ‰€æœ‰å…¬å…±å‡½æ•°éƒ½è¿”å›ä¸€ä¸ª <code>bool</code> å€¼ï¼Œè¯¥ <code>bool</code> å€¼ä»…æŒ‡ç¤ºè°ƒç”¨æ˜¯å¦æˆåŠŸã€‚åœ¨Rustä¸­ï¼Œè¿™äº›å‡½æ•°é€šå¸¸ä¼šè¿”å›ä¸€ä¸ª <code>Result</code>ã€‚</p>
<h3 id="åˆ›å»ºtokenä¾›åº”"><a class="header" href="#åˆ›å»ºtokenä¾›åº”">åˆ›å»ºtokenä¾›åº”</a></h3>
<p>å¤„ç† <code>ERC-20</code> ä»£å¸çš„æ™ºèƒ½åˆçº¦ç±»ä¼¼äºä¸Šä¸€èŠ‚æ•™ç¨‹<a href="#%E4%BD%BF%E7%94%A8maps%E5%AD%98%E5%82%A8%E5%80%BC">ä½¿ç”¨mapså­˜å‚¨å€¼</a>çš„ Incrementer åˆçº¦ã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼ŒERC-20 åˆçº¦ç”±å›ºå®šçš„ä»£å¸ä¾›åº”ç»„æˆï¼Œå½“éƒ¨ç½²åˆåŒæ—¶ï¼Œè¿™äº›ä»£å¸å…¨éƒ¨å­˜å…¥ä¸åˆåŒæ‰€æœ‰è€…ç›¸å…³è”çš„å¸æˆ·ã€‚ç„¶åï¼ŒåˆåŒæ‰€æœ‰è€…å¯ä»¥å°†ä»£å¸åˆ†å‘ç»™å…¶ä»–ç”¨æˆ·ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­åˆ›å»ºçš„ç®€å• ERC-20 åˆçº¦å¹¶ä¸æ˜¯åˆ¶é€ å’Œåˆ†å‘ä»£å¸çš„å”¯ä¸€æ–¹æ³•ã€‚ç„¶è€Œï¼Œè¿™ä¸ª ERC-20 åˆçº¦ä¸ºæ‰©å±•ä½ åœ¨å…¶ä»–æ•™ç¨‹ä¸­æ‰€å­¦åˆ°çš„çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ ink! è¯­è¨€ç”¨äºæ„å»ºæ›´å¥å£®çš„æ™ºèƒ½åˆçº¦ï¼Œæä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„åŸºç¡€ã€‚</p>
<p>å¯¹äº ERC-20 ä»£å¸åˆçº¦ï¼Œåˆå§‹å­˜å‚¨åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>total_supply</code> ä»£è¡¨åˆçº¦ä¸­ä»£å¸çš„æ€»ä¾›åº”é‡ã€‚</li>
<li><code>balances</code> è¡¨ç¤ºæ¯ä¸ªè´¦æˆ·çš„ä¸ªäººä½™é¢ã€‚</li>
</ul>
<p>è¦æ„å»ºä¸€ä¸ª ERC-20 ä»£å¸æ™ºèƒ½åˆçº¦ï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º <code>erc20</code> çš„æ–°é¡¹ç›®ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo contract new erc20
</code></pre>
<p>åœ¨ <code>erc20</code> ç›®å½•ä¸­æ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œä½¿ç”¨æ–° <a href="https://docs.substrate.io/assets/tutorials/smart-contracts/erc20-template.rs/">erc20</a> æºç æ›¿æ¢é»˜è®¤çš„æ¨¡æ¿æºç ã€‚</p>
<p>ä¿å­˜ä»£ç æ”¹å˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>æ‰“å¼€ <code>Cargo.toml</code> æ–‡ä»¶ï¼Œå¹¶æ£€æŸ¥åˆçº¦çš„ä¾èµ–å…³ç³»ã€‚</p>
<p>å¦‚æœ‰å¿…è¦ï¼Œåœ¨ <code>[dependencies]</code> éƒ¨åˆ†ï¼Œä¿®æ”¹ <code>scale</code> å’Œ <code>scale-info</code> çš„é…ç½®ï¼š</p>
<pre><code class="language-toml editable noplayground">scale = { package = &quot;parity-scale-codec&quot;, version = &quot;3&quot;, default-features = false, features = [&quot;derive&quot;] }
scale-info = { version = &quot;2&quot;, default-features = false, features = [&quot;derive&quot;], optional = true }
</code></pre>
<p>ä¿å­˜ä»£ç æ”¹å˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒéªŒè¯ç¨‹åºæ˜¯å¦ç¼–è¯‘å¹¶é€šè¿‡äº†ç®€å•çš„æµ‹è¯•ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”è¯¥æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨æ˜æµ‹è¯•æˆåŠŸå®Œæˆï¼š</p>
<pre><code class="language-bash editable noplayground">running 2 tests
test erc20::tests::new_works ... ok
test erc20::tests::balance_works ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒéªŒè¯ä½ å¯ä»¥ä¸ºåˆçº¦æ„å»º WebAssemblyã€‚</p>
<pre><code class="language-bash editable noplayground">cargo +nightly contract build
</code></pre>
<p>å¦‚æœç¨‹åºç¼–è¯‘æˆåŠŸï¼Œæ‚¨å°±å¯ä»¥åœ¨å½“å‰çŠ¶æ€ä¸Šä¼ å®ƒï¼Œæˆ–è€…å¼€å§‹å‘åˆçº¦æ·»åŠ åŠŸèƒ½ã€‚</p>
<h3 id="ä¸Šä¼ å¹¶å®ä¾‹åŒ–åˆçº¦"><a class="header" href="#ä¸Šä¼ å¹¶å®ä¾‹åŒ–åˆçº¦">ä¸Šä¼ å¹¶å®ä¾‹åŒ–åˆçº¦</a></h3>
<p>å¦‚æœä½ æƒ³æµ‹è¯•åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰çš„å†…å®¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://contracts-ui.substrate.io/">Contracts UI</a> ä¸Šä¼ è¯¥åˆçº¦ã€‚</p>
<p>åœ¨æ·»åŠ æ–°åŠŸèƒ½ä¹‹å‰æµ‹è¯• ERC-20 åˆåŒï¼š</p>
<ol>
<li>å¯åŠ¨æœ¬åœ°åˆçº¦èŠ‚ç‚¹ã€‚</li>
<li>ä¸Šä¼  <code>erc20.contract</code> æ–‡ä»¶ã€‚</li>
<li>ä¸º <code>new</code> æ„é€ å‡½æ•°æŒ‡å®šä»£å¸çš„åˆå§‹ä¾›åº”ã€‚</li>
<li>åœ¨è¿è¡Œçš„æœ¬åœ°èŠ‚ç‚¹ä¸Šå®ä¾‹åŒ–åˆåŒã€‚</li>
<li>é€‰æ‹© <code>totalSupply</code> ä½œä¸ºè¦å‘é€çš„æ¶ˆæ¯ï¼Œç„¶åç‚¹å‡» <strong>Read</strong> ä»¥éªŒè¯ä»£å¸çš„æ€»ä¾›åº”ä¸åˆå§‹ä¾›åº”ç›¸åŒã€‚</li>
<li>é€‰æ‹© <code>balanceOf</code> ä½œä¸ºè¦å‘é€çš„æ¶ˆæ¯ã€‚</li>
<li>é€‰æ‹©ç”¨äºå®ä¾‹åŒ–åˆçº¦çš„å¸æˆ· <code>AccountId</code>ï¼Œç„¶åç‚¹å‡» <strong>Read</strong>ã€‚
å¦‚æœé€‰æ‹©ä»»ä½•å…¶ä»– <code>AccountId</code>ï¼Œåˆ™ç‚¹å‡» <strong>Read</strong>ï¼Œä½™é¢ä¸ºé›¶ï¼Œå› ä¸ºæ‰€æœ‰ä»£å¸å‡ç”±åˆçº¦æ‰€æœ‰è€…æ‰€æœ‰ã€‚</li>
</ol>
<h3 id="è½¬ç§»tokens"><a class="header" href="#è½¬ç§»tokens">è½¬ç§»tokens</a></h3>
<p>æ­¤æ—¶ï¼ŒERC-20 åˆçº¦æœ‰ä¸€ä¸ªç”¨æˆ·å¸æˆ·ï¼Œè¯¥å¸æˆ·æ‹¥æœ‰è¯¥åˆçº¦ä»£å¸çš„ total_supplyã€‚ä¸ºäº†ä½¿è¯¥åˆçº¦æœ‰ç”¨ï¼Œåˆçº¦æ‰€æœ‰è€…å¿…é¡»èƒ½å¤Ÿå°†ä»£å¸è½¬ç§»åˆ°å…¶ä»–å¸æˆ·ã€‚å¯¹äºè¿™ä¸ªç®€å•çš„ ERC-20 åˆçº¦ï¼Œä½ å°†æ·»åŠ ä¸€ä¸ªå…¬å…± <code>transfer</code> å‡½æ•°ï¼Œä½¿ä½ ä½œä¸ºåˆçº¦è°ƒç”¨è€…èƒ½å¤Ÿå°†ä½ æ‹¥æœ‰çš„ä»£å¸è½¬ç§»ç»™å¦ä¸€ä¸ªç”¨æˆ·ã€‚</p>
<p>å…¬å…± <code>transfer</code> å‡½æ•°è°ƒç”¨ç§æœ‰ <code>transfer_from_to()</code> å‡½æ•°ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œæ‰€ä»¥ä¸éœ€è¦ä»»ä½•æˆæƒæ£€æŸ¥å°±å¯ä»¥è°ƒç”¨å®ƒã€‚ä½†æ˜¯ï¼Œè½¬è´¦é€»è¾‘å¿…é¡»èƒ½å¤Ÿç¡®å®š <code>from</code> å¸æˆ·æ˜¯å¦å…·æœ‰å¯è½¬ç§»åˆ°æ¥æ”¶æ–¹ <code>to</code> å¸æˆ·çš„ä»£å¸æ•°é‡ã€‚<code>transfer_from_to()</code> å‡½æ•°ä½¿ç”¨åˆçº¦è°ƒç”¨è€…ï¼ˆ<code>self.env().caller()</code>ï¼‰ä½œä¸º <code>from</code> å¸æˆ·ã€‚åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>transfer_from_to()</code> å‡½æ•°æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>è·å– <code>from</code> å¸æˆ·å’Œ <code>to</code> å¸æˆ·çš„å½“å‰ä½™é¢ã€‚</li>
<li>æ£€æŸ¥ <code>from </code> ä½™é¢æ˜¯å¦å°äºè¦å‘é€çš„ä»£å¸çš„ <code>value </code>ã€‚</li>
</ul>
<pre><code class="language-rust editable noplayground">let from_balance = self.balance_of(from);
if from_balance &lt; value {
return Err(Error::InsufficientBalance)
}
</code></pre>
<p>ä»è½¬ç§»è´¦æˆ·ä¸­å‡å»è¯¥å€¼ï¼Œå¹¶å°†è¯¥å€¼æ·»åŠ åˆ°æ¥æ”¶è´¦æˆ·ã€‚</p>
<pre><code class="language-rust editable noplayground">self.balances.insert(from, &amp;(from_balance - value));
let to_balance = self.balance_of(to);
self.balances.insert(to, &amp;(to_balance + value));
</code></pre>
<p>è¦æ·»åŠ è½¬ç§»å‡½æ•°åˆ°æ™ºèƒ½åˆçº¦ï¼Œåœ¨ <code>erc20</code> é¡¹ç›®ç›®å½•ä¸­ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ª <code>Error</code> å£°æ˜ï¼Œä»¥åœ¨å¸æˆ·ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ä»£å¸æ¥å®Œæˆè½¬è´¦æ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>
<pre><code class="language-rust editable noplayground">/// Specify ERC-20 error type.
#[derive(Debug, PartialEq, Eq, scale::Encode, scale::Decode)]
#[cfg_attr(feature = &quot;std&quot;, derive(scale_info::TypeInfo))]
pub enum Error {
/// Return if the balance cannot fulfill a request.
   InsufficientBalance,
}
</code></pre>
<p>æ·»åŠ ä¸€ä¸ª <code>Result</code> è¿”å›ç±»å‹ï¼Œä»¥è¿”å› <code>InsufficientBalance</code> é”™è¯¯ã€‚</p>
<pre><code class="language-rust editable noplayground">/// Specify the ERC-20 result type.
pub type Result&lt;T&gt; = core::result::Result&lt;T, Error&gt;;
</code></pre>
<p>æ·»åŠ  <code>transfer()</code> å…¬å…±å‡½æ•°ï¼Œä½¿åˆçº¦è°ƒç”¨è€…èƒ½å¤Ÿå°†ä»£å¸è½¬ç§»åˆ°å¦ä¸€ä¸ªå¸æˆ·ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn transfer(&amp;mut self, to: AccountId, value: Balance) -&gt; Result&lt;()&gt; {
   let from = self.env().caller();
   self.transfer_from_to(&amp;from, &amp;to, value)
}
</code></pre>
<p>æ·»åŠ  <code>transfer_from_to()</code> ç§æœ‰å‡½æ•°ï¼Œå°†ä»£å¸ä»ä¸åˆçº¦è°ƒç”¨è€…å…³è”çš„å¸æˆ·è½¬ç§»åˆ°æ¥æ”¶å¸æˆ·ã€‚</p>
<pre><code class="language-rust editable noplayground">fn transfer_from_to(
   &amp;mut self,
   from: &amp;AccountId,
   to: &amp;AccountId,
   value: Balance,
) -&gt; Result&lt;()&gt; {
    let from_balance = self.balance_of_impl(from);
    if from_balance &lt; value {
        return Err(Error::InsufficientBalance)
    }

    self.balances.insert(from, &amp;(from_balance - value));
    let to_balance = self.balance_of_impl(to);
    self.balances.insert(to, &amp;(to_balance + value));
    Ok(())
}
</code></pre>
<p>è¿™æ®µä»£ç ç‰‡æ®µä½¿ç”¨äº† <code>balance_of_impl()</code> å‡½æ•°ï¼Œ<code>balance_of_impl()</code> å‡½æ•°ä¸ <code>balance_of</code> å‡½æ•°ç›¸åŒï¼Œä¸åŒçš„æ˜¯å®ƒä½¿ç”¨å¼•ç”¨åœ¨ WebAssembly ä¸­ä»¥æ›´æœ‰æ•ˆçš„æ–¹å¼æŸ¥æ‰¾å¸æˆ·ä½™é¢ã€‚åœ¨æ™ºèƒ½åˆçº¦ä¸­æ·»åŠ å¦‚ä¸‹å‡½æ•°å³å¯ä½¿ç”¨è¯¥åŠŸèƒ½ï¼š</p>
<pre><code class="language-rust editable noplayground">#[inline]
fn balance_of_impl(&amp;self, owner: &amp;AccountId) -&gt; Balance {
   self.balances.get(owner).unwrap_or_default()
}
</code></pre>
<p>é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒéªŒè¯ç¨‹åºæ˜¯å¦ç¼–è¯‘å¹¶é€šè¿‡äº†æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”è¯¥æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨æ˜æµ‹è¯•æˆåŠŸå®Œæˆï¼š</p>
<pre><code class="language-bash editable noplayground">running 3 tests
test erc20::tests::new_works ... ok
test erc20::tests::balance_works ... ok
test erc20::tests::transfer_works ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<h3 id="åˆ›å»ºäº‹ä»¶"><a class="header" href="#åˆ›å»ºäº‹ä»¶">åˆ›å»ºäº‹ä»¶</a></h3>
<p>ERC-20 ä»£å¸æ ‡å‡†è§„å®šåˆçº¦è°ƒç”¨åœ¨æäº¤ä¸€ä¸ªäº¤æ˜“æ—¶ä¸èƒ½ç›´æ¥è¿”å›å€¼ã€‚ç„¶è€Œï¼Œä½ å¯èƒ½å¸Œæœ›ä½ çš„æ™ºèƒ½åˆçº¦ä»¥æŸç§æ–¹å¼å‘å‡ºå·²ç»å‘ç”Ÿäº‹ä»¶çš„ä¿¡å·ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›ä½ çš„æ™ºèƒ½åˆçº¦æ˜¾ç¤ºäº¤æ˜“å®Œæˆçš„æ—¶é—´æˆ–è½¬è´¦é€šè¿‡çš„æ—¶é—´ï¼Œä½ å¯ä»¥ä½¿ç”¨äº‹ä»¶æ¥å‘é€è¿™äº›ç±»ä¿¡å·ã€‚ä½ å¯ä»¥ä½¿ç”¨äº‹ä»¶ä¸ä»»ä½•ç±»å‹çš„æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œä¸ºä¸€ä¸ªäº‹ä»¶å®šä¹‰æ•°æ®ç±»ä¼¼äºå®šä¹‰ <code>struct</code>ã€‚äº‹ä»¶åº”è¯¥ä½¿ç”¨ <code>#[ink(event)]</code> å±æ€§è¢«å£°æ˜ã€‚</p>
<h4 id="æ·»åŠ ä¸€ä¸ªè½¬ç§»äº‹ä»¶"><a class="header" href="#æ·»åŠ ä¸€ä¸ªè½¬ç§»äº‹ä»¶">æ·»åŠ ä¸€ä¸ªè½¬ç§»äº‹ä»¶</a></h4>
<p>å£°æ˜ä¸€ä¸ª <code>Transfer</code> äº‹ä»¶ï¼Œä»¥æä¾›æœ‰å…³å·²å®Œæˆè½¬ç§»æ“ä½œçš„ä¿¡æ¯ã€‚<code>Transfer</code> äº‹ä»¶åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li><code>Balance</code> ç±»å‹çš„å€¼ã€‚</li>
<li><code>from</code> å¸æˆ·çš„ä¸€ä¸ª Option-wrapped <code>AccountId</code> å˜é‡ã€‚</li>
<li><code>to</code> å¸æˆ·çš„ä¸€ä¸ª Option-wrapped <code>AccountId</code> å˜é‡ã€‚</li>
</ul>
<p>ä¸ºäº†æ›´å¿«åœ°è®¿é—®äº‹ä»¶æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•å­—æ®µã€‚ä½ å¯ä»¥é€šè¿‡åœ¨è¯¥å­—æ®µä¸Šä½¿ç”¨ <code>#[ink(topic)]</code> å±æ€§æ ‡ç­¾æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<p>è¦æ·»åŠ ä¸€ä¸ª <code>Transfer</code> äº‹ä»¶ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œä½¿ç”¨ <code>#[ink(event)]</code> å±æ€§å®å£°æ˜äº‹ä»¶ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(event)]
pub struct Transfer {
   #[ink(topic)]
   from: Option&lt;AccountId&gt;,
   #[ink(topic)]
   to: Option&lt;AccountId&gt;,
   value: Balance,
 }
</code></pre>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>.unwrap_or()</code> å‡½æ•°ä¸º <code>Option&lt;T&gt;</code> å˜é‡æ£€ç´¢æ•°æ®ã€‚</p>
<h4 id="å‘å‡ºäº‹ä»¶"><a class="header" href="#å‘å‡ºäº‹ä»¶">å‘å‡ºäº‹ä»¶</a></h4>
<p>ç°åœ¨ä½ å·²ç»å£°æ˜äº†äº‹ä»¶å¹¶å®šä¹‰äº†äº‹ä»¶åŒ…å«çš„ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥éœ€è¦æ·»åŠ å‘å‡ºäº‹ä»¶çš„ä»£ç ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>self.env().emit_event()</code> æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå°†äº‹ä»¶åç§°ä½œä¸ºè°ƒç”¨çš„å”¯ä¸€å‚æ•°ã€‚</p>
<p>åœ¨è¿™ä¸ª ERC-20 åˆçº¦ä¸­ï¼Œä½ å¸Œæœ›åœ¨æ¯æ¬¡å‘ç”Ÿè½¬ç§»æ—¶å‘å‡ºä¸€ä¸ª <code>Transfer</code> äº‹ä»¶ï¼Œä»£ç ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹å‡ºç°äº†è¿™ç§æƒ…å†µ</p>
<ul>
<li>åœ¨åˆå§‹åŒ–åˆçº¦çš„ <code>new</code> è°ƒç”¨æœŸé—´ã€‚</li>
<li>æ¯æ¬¡è°ƒç”¨ <code>transfer_from_to</code>ã€‚</li>
</ul>
<p><code>from</code> å’Œ <code>to</code> å­—æ®µçš„å€¼æ˜¯ <code>Option&lt;AccountId&gt;</code> æ•°æ®ç±»å‹ã€‚ç„¶è€Œï¼Œåœ¨ tokens çš„åˆå§‹è½¬ç§»è¿‡ç¨‹ä¸­ï¼Œä¸º initialsupply è®¾ç½®çš„å€¼ä¸æ˜¯æ¥è‡ªä»»ä½•å…¶ä»–å¸æˆ·ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒTransfer äº‹ä»¶çš„ <code>from</code> å€¼ä¸º <code>None</code>ã€‚</p>
<p>è¦å‘å‡º Transfer äº‹ä»¶ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œåœ¨ <code>new</code> æ„é€ å‡½æ•°ä¸­å°† <code>Transfer</code> äº‹ä»¶æ·»åŠ åˆ° <code>new_init()</code> å‡½æ•°ä¸­ã€‚</p>
<pre><code class="language-rust editable noplayground">fn new_init(&amp;mut self, initial_supply: Balance) {
   let caller = Self::env().caller();
   self.balances.insert(&amp;caller, &amp;initial_supply);
   self.total_supply = initial_supply;
   Self::env().emit_event(Transfer {
       from: None,
       to: Some(caller),
       value: initial_supply,
     });
   }
</code></pre>
<p>å°† <code>Transfer</code> äº‹ä»¶æ·»åŠ åˆ° <code>transfer_from_to()</code> å‡½æ•°ä¸­ã€‚</p>
<pre><code class="language-rust editable noplayground">self.balances.insert(from, &amp;(from_balance - value));
let to_balance = self.balance_of_impl(to);
self.balances.insert(to, &amp;(to_balance + value));
self.env().emit_event(Transfer {
   from: Some(*from),
   to: Some(*to),
   value,
});
</code></pre>
<p>æ³¨æ„ <code>value </code> ä¸éœ€è¦ <code>Some()</code>ï¼Œå› ä¸ºå€¼æ²¡æœ‰å­˜å‚¨åœ¨ <code>Option</code> ä¸­ã€‚</p>
<p>æ·»åŠ ä¸€ä¸ªå°†ä»£å¸ä»ä¸€ä¸ªå¸æˆ·è½¬ç§»åˆ°å¦ä¸€ä¸ªå¸æˆ·çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink::test]
fn transfer_works() {
   let mut erc20 = Erc20::new(100);
   assert_eq!(erc20.balance_of(AccountId::from([0x0; 32])), 0);
   assert_eq!(erc20.transfer((AccountId::from([0x0; 32])), 10), Ok(()));
   assert_eq!(erc20.balance_of(AccountId::from([0x0; 32])), 10);
}
</code></pre>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ç¨‹åºçš„ç¼–è¯‘å¹¶ä¸”é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<pre><code class="language-rust editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”è¯¥æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨ç¤ºæˆåŠŸå®Œæˆæµ‹è¯•ï¼š</p>
<pre><code class="language-bash editable noplayground">running 3 tests
test erc20::tests::new_works ... ok
test erc20::tests::balance_works ... ok
test erc20::tests::transfer_works ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<h3 id="å¯ç”¨ç¬¬ä¸‰æ–¹è½¬è´¦"><a class="header" href="#å¯ç”¨ç¬¬ä¸‰æ–¹è½¬è´¦">å¯ç”¨ç¬¬ä¸‰æ–¹è½¬è´¦</a></h3>
<p>ERC-20 ä»£å¸åˆçº¦ç°åœ¨å¯ä»¥åœ¨è´¦æˆ·ä¹‹é—´è½¬ç§»ä»£å¸ï¼Œå¹¶åœ¨å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶å‘å‡ºäº‹ä»¶ã€‚ä½œä¸ºæœ€åä¸€æ­¥ï¼Œä½ å¯ä»¥æ·»åŠ  <code>approve</code> å’Œ <code>transfer_from</code> å‡½æ•°ä»¥å¯ç”¨ç¬¬ä¸‰æ–¹è½¬è´¦ã€‚</p>
<p>å…è®¸ä¸€ä¸ªè´¦æˆ·ä»£è¡¨å¦ä¸€ä¸ªè´¦æˆ·æ¶ˆè´¹ä»£å¸ï¼Œå…è®¸ä½ çš„æ™ºèƒ½åˆçº¦æ”¯æŒå»ä¸­å¿ƒåŒ–çš„äº¤æ˜“æ‰€ã€‚ä½ å¯ä»¥æ‰¹å‡†ä½ æ‰€æ‹¥æœ‰çš„ä¸€äº›ä»£å¸ä»¥ä½ çš„åä¹‰è¿›è¡Œäº¤æ˜“ï¼Œè€Œä¸æ˜¯åœ¨åˆåŒä¸­ç›´æ¥å°†ä½ çš„ä»£å¸è½¬è®©ç»™å¦ä¸€ä¸ªç”¨æˆ·ã€‚å½“ä½ ç­‰å¾…äº¤æ˜“æ‰§è¡Œæ—¶ï¼Œå¦‚æœéœ€è¦ï¼Œä½ ä»ç„¶å¯ä»¥æ§åˆ¶å’Œä½¿ç”¨ä½ çš„ä»£å¸ã€‚ä½ è¿˜å¯ä»¥æ‰¹å‡†å¤šä¸ªåˆçº¦æˆ–ç”¨æˆ·è®¿é—®ä½ çš„ä»£å¸ï¼Œå› æ­¤ï¼Œå¦‚æœä¸€ä¸ªåˆçº¦æä¾›äº†æœ€å¥½çš„äº¤æ˜“ï¼Œä½ ä¸éœ€è¦å°†ä»£å¸ä»ä¸€ä¸ªåˆçº¦ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåˆçº¦ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé«˜æˆæœ¬å’Œè€—æ—¶çš„è¿‡ç¨‹ã€‚</p>
<p>ä¸ºäº†ç¡®ä¿æ‰¹å‡†å’Œè½¬ç§»å¯ä»¥å®‰å…¨å®Œæˆï¼ŒERC-20 ä»£å¸åˆçº¦ä½¿ç”¨ä¸¤æ­¥æµç¨‹ï¼Œåˆ†åˆ«ä»æ“ä½œä¸­è¿›è¡Œæ‰¹å‡†å’Œè½¬ç§»ã€‚</p>
<h4 id="æ·»åŠ æ‰¹å‡†é€»è¾‘"><a class="header" href="#æ·»åŠ æ‰¹å‡†é€»è¾‘">æ·»åŠ æ‰¹å‡†é€»è¾‘</a></h4>
<p>æ‰¹å‡†å¦ä¸€ä¸ªå¸æˆ·æ¥ä½¿ç”¨ä½ çš„ä»£å¸æ˜¯ç¬¬ä¸‰æ–¹è½¬è´¦æµç¨‹çš„ç¬¬ä¸€æ­¥ã€‚ä½œä¸ºä¸€ä¸ªä»£å¸æ‰€æœ‰è€…ï¼Œä½ å¯ä»¥æŒ‡å®šä»»ä½•å¸æˆ·ä»£è¡¨è½¬è´¦ï¼Œä»¥åŠè½¬è´¦ä»»æ„æ•°é‡çš„ä»£å¸ã€‚ä½ ä¸éœ€è¦æ‰¹å‡†å¸æˆ·ä¸­çš„æ‰€æœ‰ä»¤ç‰Œï¼Œä½ å¯ä»¥æŒ‡å®šæ‰¹å‡†ä¸€ä¸ªå¸æˆ·å…è®¸è½¬è´¦çš„æœ€å¤§æ•°é‡ã€‚</p>
<p>å½“å¤šæ¬¡è°ƒç”¨ <code>approve</code> æ—¶ï¼Œå°†ç”¨æ–°å€¼è¦†ç›–å…ˆå‰æ‰¹å‡†çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»æ„ä¸¤ä¸ªå¸æˆ·ä¹‹é—´çš„æ‰¹å‡†å€¼ä¸º <code>0</code>ã€‚å¦‚æœä½ æƒ³æ’¤é”€å¸æˆ·ä¸­å¯¹ä»£å¸çš„è®¿é—®ï¼Œå¯ä»¥è°ƒç”¨å€¼ä¸º <code>0</code> çš„ <code>approve</code> å‡½æ•°ã€‚</p>
<p>è¦åœ¨ ERC-20 åˆçº¦ä¸­å­˜å‚¨æ‰¹å‡†ï¼Œä½ éœ€è¦ä½¿ç”¨ç¨å¾®å¤æ‚ä¸€äº›çš„ <code>Mapping</code> é”®ã€‚ç”±äºæ¯ä¸ªå¸æˆ·å¯ä»¥æœ‰ä¸åŒçš„æ‰¹å‡†é‡‘é¢ä¾›å…¶ä»–ä»»ä½•å¸æˆ·ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å…ƒç»„ä½œä¸ºæ˜ å°„åˆ°ä½™é¢å€¼çš„é”®ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-rust editable noplayground">pub struct Erc20 {
 /// Balances that can be transferred by non-owners: (owner, spender) -&gt; allowed
 allowances: ink_storage::Mapping&lt;(AccountId, AccountId), Balance&gt;,
}
</code></pre>
<p>å…ƒç»„ä½¿ç”¨ <code>(owner, spender)</code> æ¥æ ‡è¯† <code>spender</code> å¸æˆ·ï¼Œè¯¥å¸æˆ·è¢«å…è®¸åœ¨æŒ‡å®š <code>allowance</code> ä»£è¡¨ <code>owner</code> è®¿é—®ä»£å¸ã€‚</p>
<p>è¦ä¸ºæ™ºèƒ½åˆçº¦æ·»åŠ æ‰¹å‡†é€»è¾‘ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œä½¿ç”¨ <code>#[ink(event)]</code> å±æ€§å®å£°æ˜ <code>Approval</code> äº‹ä»¶ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(event)]
pub struct Approval {
   #[ink(topic)]
   owner: AccountId,
   #[ink(topic)]
   spender: AccountId,
   value: Balance,
}
</code></pre>
<p>æ·»åŠ ä¸€ä¸ª <code>Error</code> å£°æ˜ï¼Œä»¥ä¾¿åœ¨è½¬è´¦è¯·æ±‚è¶…è¿‡å¸æˆ·é™é¢æ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>
<pre><code class="language-rust editable noplayground">#[derive(Debug, PartialEq, Eq, scale::Encode, scale::Decode)]
#[cfg_attr(feature = &quot;std&quot;, derive(scale_info::TypeInfo))]
pub enum Error {
   InsufficientBalance,
   InsufficientAllowance,
}
</code></pre>
<p>å°†æ‰€æœ‰è€…å’Œéæ‰€æœ‰è€…ç»„åˆçš„å­˜å‚¨æ˜ å°„æ·»åŠ åˆ°å¸æˆ·ä½™é¢ã€‚</p>
<pre><code class="language-rust editable noplayground">allowances: Mapping&lt;(AccountId, AccountId), Balance&gt;,
</code></pre>
<p>æ·»åŠ  <code>approve()</code> å‡½æ•°æ¥æˆæƒ <code>spender</code> å¸æˆ·ä»è°ƒç”¨è€…çš„å¸æˆ·ä¸­æå–ä»£å¸ï¼Œç›´åˆ°å–åˆ°æœ€å¤§ <code>value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn approve(&amp;mut self, spender: AccountId, value: Balance) -&gt; Result&lt;()&gt; {
   let owner = self.env().caller();
   self.allowances.insert((&amp;owner, &amp;spender), &amp;value);
   self.env().emit_event(Approval {
     owner,
     spender,
     value,
   });
   Ok(())
}
</code></pre>
<p>æ·»åŠ ä¸€ä¸ª <code>allowance()</code> å‡½æ•°æ¥è¿”å›å…è®¸ <code>spender</code> ä» <code>owner</code> å¸æˆ·ä¸­æå–çš„ä»£å¸æ•°é‡ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink(message)]
pub fn allowance(&amp;self, owner: AccountId, spender: AccountId) -&gt; Balance {
   self.allowance_impl(&amp;owner, &amp;spender)
}
</code></pre>
<p>è¿™æ®µä»£ç ç‰‡æ®µä½¿ç”¨äº† <code>allowance_impl()</code> å‡½æ•°ã€‚<code>allowance_impl()</code> å‡½æ•°ä¸ <code>allowance</code> å‡½æ•°ç›¸åŒï¼Œä¸åŒä¹‹å¤„æ˜¯å®ƒä½¿ç”¨å¼•ç”¨æ¥åœ¨ WebAssembly ä¸­ä»¥æ›´æœ‰æ•ˆçš„æ–¹å¼æŸ¥æ‰¾ä»£å¸é™é¢ã€‚åœ¨æ™ºèƒ½åˆçº¦ä¸­æ·»åŠ å¦‚ä¸‹å‡½æ•°å³å¯ä½¿ç”¨è¯¥åŠŸèƒ½ï¼š</p>
<pre><code class="language-rust editable noplayground">#[inline]
fn allowance_impl(&amp;self, owner: &amp;AccountId, spender: &amp;AccountId) -&gt; Balance {
   self.allowances.get((owner, spender)).unwrap_or_default()
}
</code></pre>
<h4 id="ä»é€»è¾‘ä¸­æ·»åŠ è½¬è´¦"><a class="header" href="#ä»é€»è¾‘ä¸­æ·»åŠ è½¬è´¦">ä»é€»è¾‘ä¸­æ·»åŠ è½¬è´¦</a></h4>
<p>ç°åœ¨ä½ å·²ç»ä¸ºä¸€ä¸ªå¸æˆ·è®¾ç½®äº†ä»£è¡¨å¦ä¸€ä¸ªå¸æˆ·è½¬ç§»ä»£å¸çš„æ‰¹å‡†ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª <code>transfer_from</code> å‡½æ•°ï¼Œä»¥å…è®¸å·²æ‰¹å‡†çš„ç”¨æˆ·è½¬ç§»ä»£å¸ã€‚<code>transfer_from</code> å‡½æ•°è°ƒç”¨ç§æœ‰ <code>transfer_from_to</code> å‡½æ•°æ¥æ‰§è¡Œå¤§éƒ¨åˆ†è½¬ç§»é€»è¾‘ã€‚æˆæƒéæ‰€æœ‰è€…è½¬è®©ä»£å¸æœ‰å‡ ä¸ªè¦æ±‚ï¼š</p>
<ul>
<li><code>self.env().caller()</code> åˆçº¦è°ƒç”¨è€…åˆ†é…çš„å¿…é¡»æ˜¯ <code>from</code> å¸æˆ·ä¸­å¯ç”¨çš„ä»£å¸ã€‚</li>
<li>åˆ†é…çš„å­˜å‚¨ä½œä¸º <code>allowance</code> å¿…é¡»å¤§äºè¦è½¬ç§»çš„å€¼ã€‚</li>
</ul>
<p>å¦‚æœæ»¡è¶³äº†è¿™äº›è¦æ±‚ï¼Œåˆçº¦å°†æ›´æ–°çš„é™é¢æ’å…¥åˆ° <code>allowance</code> å˜é‡ä¸­ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„ <code>from</code> å’Œ <code>to</code> å¸æˆ·è°ƒç”¨ <code>transfer_from_to()</code> å‡½æ•°ã€‚</p>
<p>è®°ä½ï¼Œåœ¨è°ƒç”¨ <code>transfer_from</code> æ—¶ï¼Œ<code>self.env().caller()</code> å’Œ <code>from</code> å¸æˆ·ç”¨äºæŸ¥æ‰¾å½“å‰é™é¢ï¼Œä½† <code>transfer_from</code> å‡½æ•°æ˜¯åœ¨æŒ‡å®šçš„ <code>from</code> å’Œ <code>to</code> å¸æˆ·ä¹‹é—´è¢«è°ƒç”¨çš„ã€‚</p>
<p>æ¯å½“è°ƒç”¨ <code>transfer_from</code> æ—¶ï¼Œå°†ä½¿ç”¨ä¸‰ä¸ªå¸æˆ·å˜é‡ï¼Œä½ éœ€è¦ç¡®ä¿æ­£ç¡®ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>è¦ä¸ºæ™ºèƒ½åˆçº¦æ·»åŠ  <code>transfer_from</code>ï¼Œæ‰“å¼€ <code>lib.rs</code> æ–‡ä»¶ï¼Œæ·»åŠ  <code>transfer_from()</code> å‡½æ•°ï¼Œä»¥ä»£è¡¨ <code>from</code> å¸æˆ·åˆ° <code>to</code> å¸æˆ·è½¬ç§»ä»£å¸çš„ <code>value</code>ã€‚</p>
<pre><code class="language-rust editable noplayground">/// Transfers tokens on the behalf of the `from` account to the `to account
#[ink(message)]
pub fn transfer_from(
   &amp;mut self,
   from: AccountId,
   to: AccountId,
   value: Balance,
) -&gt; Result&lt;()&gt; {
   let caller = self.env().caller();
   let allowance = self.allowance_impl(&amp;from, &amp;caller);
   if allowance &lt; value {
       return Err(Error::InsufficientAllowance)
   }
   self.transfer_from_to(&amp;from, &amp;to, value)?;
   self.allowances
       .insert((&amp;from, &amp;caller), &amp;(allowance - value));
   Ok(())
  }
</code></pre>
<p>ä¸º <code>transfer_from()</code> å‡½æ•°æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚</p>
<pre><code class="language-rust editable noplayground">#[ink::test]
fn transfer_from_works() {
   let mut contract = Erc20::new(100);
   assert_eq!(contract.balance_of(AccountId::from([0x1; 32])), 100);
   contract.approve(AccountId::from([0x1; 32]), 20);
   contract.transfer_from(AccountId::from([0x1; 32]), AccountId::from([0x0; 32]), 10);
   assert_eq!(contract.balance_of(AccountId::from([0x0; 32])), 10);
}
</code></pre>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ç¨‹åºçš„ç¼–è¯‘å¹¶ä¸”é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<pre><code class="language-bash editable noplayground">cargo +nightly test
</code></pre>
<p>è¯¥å‘½ä»¤åº”æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œä»¥è¡¨ç¤ºæµ‹è¯•æˆåŠŸå®Œæˆï¼š</p>
<pre><code class="language-bash editable noplayground">running 5 tests
test erc20::tests::new_works ... ok
test erc20::tests::balance_works ... ok
test erc20::tests::transfer_works ... ok
test erc20::tests::transfer_from_works ... ok
test erc20::tests::allowances_works ... ok

test result: ok. 5 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ä½ å¯ä»¥ä¸ºè¯¥åˆçº¦æ„å»º WebAssemnbly</p>
<pre><code class="language-bash editable noplayground">cargo +nightly contract build
</code></pre>
<p>åœ¨æ„å»ºäº†åˆçº¦çš„ WebAssembly ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨ Contracts UI ä¸Šä¼ å¹¶å®ä¾‹åŒ–å®ƒï¼Œå¦‚<a href="#%E4%B8%8A%E4%BC%A0%E5%B9%B6%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%90%88%E7%BA%A6">ä¸Šä¼ å¹¶å®ä¾‹åŒ–åˆçº¦</a>ä¸­æ‰€è¿°ã€‚</p>
<h3 id="ç¼–å†™æµ‹è¯•ç”¨ä¾‹"><a class="header" href="#ç¼–å†™æµ‹è¯•ç”¨ä¾‹">ç¼–å†™æµ‹è¯•ç”¨ä¾‹</a></h3>
<p>åœ¨æœ¬èŠ‚æ•™ç¨‹ä¸­ï¼Œä½ å‘ <code>lib.rs</code> æ–‡ä»¶ä¸­æ·»åŠ äº†ç®€å•çš„å•å…ƒæµ‹è¯•ã€‚åŸºæœ¬çš„æµ‹è¯•ç”¨ä¾‹é€šè¿‡ç»™å‡ºæŒ‡å®šçš„è¾“å…¥å€¼å¹¶éªŒè¯è¿”å›çš„ç»“æœæ¥è¯´æ˜å‡½æ•°æŒ‰é¢„æœŸå·¥ä½œã€‚ä½ å¯ä»¥é€šè¿‡ç¼–å†™é¢å¤–çš„æµ‹è¯•ç”¨ä¾‹æ¥æé«˜ä»£ç çš„è´¨é‡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ·»åŠ æµ‹è¯•ï¼Œå¯¹æ— æ•ˆè¾“å…¥ã€ç©ºå€¼æˆ–è¶…å‡ºé¢„æœŸèŒƒå›´çš„å€¼è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p>
<p>erc20 æœ€ç»ˆä»£ç ï¼š</p>
<pre><code class="language-rust editable noplayground">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]

use ink_lang as ink;

#[ink::contract]
mod erc20 {
    use ink_storage::traits::SpreadAllocate;

    #[ink(event)]
    pub struct Transfer {
        #[ink(topic)]
        from: Option&lt;AccountId&gt;,
        #[ink(topic)]
        to: Option&lt;AccountId&gt;,
        #[ink(topic)]
        value: Balance,
    }

    #[ink(event)]
    pub struct Approval {
        #[ink(topic)]
        owner: AccountId,
        #[ink(topic)]
        spender: AccountId,
        #[ink(topic)]
        value: Balance,
    }

    #[cfg(not(feature = &quot;ink-as-dependency&quot;))]
    #[ink(storage)]
    #[derive(SpreadAllocate)]
    pub struct Erc20 {
        /// The total supply.
        total_supply: Balance,
        /// The balance of each user.
        balances: ink_storage::Mapping&lt;AccountId, Balance&gt;,
        /// Approval spender on behalf of the message's sender.
        allowances: ink_storage::Mapping&lt;(AccountId, AccountId), Balance&gt;,
    }

    impl Erc20 {
        #[ink(constructor)]
        pub fn new(initial_supply: Balance) -&gt; Self {
            ink_lang::utils::initialize_contract(|contract: &amp;mut Self| {
                contract.total_supply = initial_supply;
                let caller = Self::env().caller();
                contract.balances.insert(&amp;caller, &amp;initial_supply);

                // NOTE: `allowances` is default initialized by `initialize_contract`, so we don't
                // need to do anything here

                Self::env().emit_event(Transfer {
                    from: None,
                    to: Some(caller),
                    value: initial_supply,
                });
            })
        }

        #[ink(message)]
        pub fn total_supply(&amp;self) -&gt; Balance {
            self.total_supply
        }

        #[ink(message)]
        pub fn balance_of(&amp;self, owner: AccountId) -&gt; Balance {
            self.balances.get(&amp;owner).unwrap_or_default()
        }

        #[ink(message)]
        pub fn approve(&amp;mut self, spender: AccountId, value: Balance) -&gt; bool {
            // Record the new allowance.
            let owner = self.env().caller();
            self.allowances.insert(&amp;(owner, spender), &amp;value);

            // Notify offchain users of the approval and report success.
            self.env().emit_event(Approval {
                owner,
                spender,
                value,
            });

            true
        }

        #[ink(message)]
        pub fn allowance(&amp;self, owner: AccountId, spender: AccountId) -&gt; Balance {
            self.allowance_of_or_zero(&amp;owner, &amp;spender)
        }

        #[ink(message)]
        pub fn transfer_from(
            &amp;mut self,
            from: AccountId,
            to: AccountId,
            value: Balance,
        ) -&gt; bool {
            // Ensure that a sufficient allowance exists.
            let caller = self.env().caller();
            let allowance = self.allowance_of_or_zero(&amp;from, &amp;caller);
            if allowance &lt; value {
                return false
            }

            let transfer_result = self.transfer_from_to(from, to, value);
            // Check `transfer_result` because `from` account may not have enough balance
            //   and return false.
            if !transfer_result {
                return false
            }

            // Decrease the value of the allowance and transfer the tokens.
            self.allowances.insert((from, caller), &amp;(allowance - value));
            true
        }

        #[ink(message)]
        pub fn transfer(&amp;mut self, to: AccountId, value: Balance) -&gt; bool {
            self.transfer_from_to(self.env().caller(), to, value)
        }

        fn transfer_from_to(
            &amp;mut self,
            from: AccountId,
            to: AccountId,
            value: Balance,
        ) -&gt; bool {
            let from_balance = self.balance_of(from);
            if from_balance &lt; value {
                return false
            }

            // Update the sender's balance.
            self.balances.insert(&amp;from, &amp;(from_balance - value));

            // Update the receiver's balance.
            let to_balance = self.balance_of(to);
            self.balances.insert(&amp;to, &amp;(to_balance + value));

            self.env().emit_event(Transfer {
                from: Some(from),
                to: Some(to),
                value,
            });

            true
        }

        fn allowance_of_or_zero(
            &amp;self,
            owner: &amp;AccountId,
            spender: &amp;AccountId,
        ) -&gt; Balance {
            // If you are new to Rust, you may wonder what's the deal with all the asterisks and
            // ampersends.
            //
            // In brief, using `&amp;` if we want to get the address of a value (aka reference of the
            // value), and using `*` if we have the reference of a value and want to get the value
            // back (aka dereferencing).
            //
            // To read more: https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html
            self.allowances.get(&amp;(*owner, *spender)).unwrap_or_default()
        }
    }

    #[cfg(test)]
    mod tests {
        use super::*;

        use ink_lang as ink;

        #[ink::test]
        fn new_works() {
            let contract = Erc20::new(777);
            assert_eq!(contract.total_supply(), 777);
        }

        #[ink::test]
        fn balance_works() {
            let contract = Erc20::new(100);
            assert_eq!(contract.total_supply(), 100);
            assert_eq!(contract.balance_of(AccountId::from([0x1; 32])), 100);
            assert_eq!(contract.balance_of(AccountId::from([0x0; 32])), 0);
        }

        #[ink::test]
        fn transfer_works() {
            let mut contract = Erc20::new(100);
            assert_eq!(contract.balance_of(AccountId::from([0x1; 32])), 100);
            assert!(contract.transfer(AccountId::from([0x0; 32]), 10));
            assert_eq!(contract.balance_of(AccountId::from([0x0; 32])), 10);
            assert!(!contract.transfer(AccountId::from([0x0; 32]), 100));
        }

        #[ink::test]
        fn transfer_from_works() {
            let mut contract = Erc20::new(100);
            assert_eq!(contract.balance_of(AccountId::from([0x1; 32])), 100);
            contract.approve(AccountId::from([0x1; 32]), 20);
            contract.transfer_from(
                AccountId::from([0x1; 32]),
                AccountId::from([0x0; 32]),
                10,
            );
            assert_eq!(contract.balance_of(AccountId::from([0x0; 32])), 10);
        }

        #[ink::test]
        fn allowances_works() {
            let mut contract = Erc20::new(100);
            assert_eq!(contract.balance_of(AccountId::from([0x1; 32])), 100);
            contract.approve(AccountId::from([0x1; 32]), 200);
            assert_eq!(
                contract
                    .allowance(AccountId::from([0x1; 32]), AccountId::from([0x1; 32])),
                200
            );

            assert!(contract.transfer_from(
                AccountId::from([0x1; 32]),
                AccountId::from([0x0; 32]),
                50
            ));
            assert_eq!(contract.balance_of(AccountId::from([0x0; 32])), 50);
            assert_eq!(
                contract
                    .allowance(AccountId::from([0x1; 32]), AccountId::from([0x1; 32])),
                150
            );

            assert!(!contract.transfer_from(
                AccountId::from([0x1; 32]),
                AccountId::from([0x0; 32]),
                100
            ));
            assert_eq!(contract.balance_of(AccountId::from([0x0; 32])), 50);
            assert_eq!(
                contract
                    .allowance(AccountId::from([0x1; 32]), AccountId::from([0x1; 32])),
                150
            );
        }
    }
}
</code></pre>
<h2 id="æ™ºèƒ½åˆçº¦çš„é—®é¢˜æ’æŸ¥"><a class="header" href="#æ™ºèƒ½åˆçº¦çš„é—®é¢˜æ’æŸ¥">æ™ºèƒ½åˆçº¦çš„é—®é¢˜æ’æŸ¥</a></h2>
<p>æœ¬èŠ‚ä»‹ç»äº†åœ¨åŸºäº Substrate çš„åŒºå—é“¾ä¸Šç¼–å†™å’Œéƒ¨ç½²æ™ºèƒ½åˆçº¦æ—¶å¯èƒ½é‡åˆ°çš„ä¸€äº›å¸¸è§é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
<h3 id="æ„å¤–çš„è¿è¡Œé”™è¯¯"><a class="header" href="#æ„å¤–çš„è¿è¡Œé”™è¯¯">æ„å¤–çš„è¿è¡Œé”™è¯¯</a></h3>
<p>å¦‚æœä½ åœ¨ä¸æ­£ç¡®çš„æƒ…å†µä¸‹ä¸­æ–­äº†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡å…³é—­ç»ˆç«¯æˆ–è®¡ç®—æœºåˆ‡æ¢åˆ°ç¡çœ æ¨¡å¼ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯</p>
<pre><code class="language-bash editable noplayground">ClientImport(&quot;Unexpected epoch change&quot;)
</code></pre>
<p>å¦‚æœçœ‹åˆ°æ­¤é”™è¯¯ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°å¯åŠ¨èŠ‚ç‚¹ï¼š</p>
<pre><code class="language-bash editable noplayground">substrate-contracts-node --dev
</code></pre>
<p>æ­¤å‘½ä»¤æ¸…é™¤æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹çŠ¶æ€ã€‚é‡æ–°å¯åŠ¨èŠ‚ç‚¹åï¼Œé‡å¤å…³é—­èŠ‚ç‚¹ä¹‹å‰æ‰§è¡Œçš„ä»»ä½•æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œé‡æ–°éƒ¨ç½²ä½ ä¹‹å‰ä¸Šä¼ çš„æ‰€æœ‰åˆçº¦ã€‚</p>
<h3 id="æœ¬åœ°å­˜å‚¨ä¸­çš„è¿‡æœŸåˆçº¦"><a class="header" href="#æœ¬åœ°å­˜å‚¨ä¸­çš„è¿‡æœŸåˆçº¦">æœ¬åœ°å­˜å‚¨ä¸­çš„è¿‡æœŸåˆçº¦</a></h3>
<p>Contracts UI ä½¿ç”¨å®ƒè‡ªå·±çš„æœ¬åœ°å­˜å‚¨æ¥è·Ÿè¸ªä½ å·²ç»éƒ¨ç½²çš„åˆçº¦ã€‚å¦‚æœä½ ä½¿ç”¨ Contracts UI éƒ¨ç½²åˆçº¦ï¼Œç„¶åæ¸…é™¤é“¾ä¸Šçš„èŠ‚ç‚¹æ•°æ®ï¼Œå°†æç¤ºä½ éœ€è¦é‡ç½®æœ¬åœ°å­˜å‚¨ã€‚é‡ç½® Contracts UI çš„æœ¬åœ°å­˜å‚¨åï¼Œé‡å¤æ¸…é™¤èŠ‚ç‚¹ä¹‹å‰æ‰§è¡Œçš„æ‰€æœ‰æ­¥éª¤ï¼Œå¹¶é‡æ–°éƒ¨ç½²ä¹‹å‰ä¸Šä¼ çš„æ‰€æœ‰åˆçº¦ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../blockchain/chapter_1_2_1_4.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../blockchain/chapter_1_2_1_6.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../blockchain/chapter_1_2_1_4.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../blockchain/chapter_1_2_1_6.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>


        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'G-ZHWPPT6ESV', 'auto');
                ga('send', 'pageview');
            }
        </script>


        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
